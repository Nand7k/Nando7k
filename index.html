<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Vendas Profissional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .card-shadow:hover {
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }
        
        .tab-active {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
        }
        
        .input-focus:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .success-animation {
            animation: successPulse 0.6s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .debt-positive { 
            color: #dc2626; 
            font-weight: 600;
            background: rgba(220, 38, 38, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
        }
        .debt-zero { 
            color: #059669; 
            font-weight: 600;
            background: rgba(5, 150, 105, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
        }
        .debt-negative { 
            color: #0891b2; 
            font-weight: 600;
            background: rgba(8, 145, 178, 0.1);
            padding: 2px 8px;
            border-radius: 6px;
        }
        
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .pulse-ring {
            position: relative;
        }
        
        .pulse-ring::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(79, 70, 229, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }
        
        .config-tab-active {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .config-tab-inactive {
            background: white;
            color: #6b7280;
        }
        
        .config-tab-inactive:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .config-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Filtros de per√≠odo */
        .filtro-periodo-ativo {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
        }
        
        .filtro-periodo-inativo {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .filtro-periodo-inativo:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        /* Modo Netflix - Produtividade Estrat√©gica CORRIGIDO */
        .netflix-mode {
            background: linear-gradient(135deg, #141414 0%, #1a1a1a 25%, #0f0f0f 50%, #1a1a1a 75%, #141414 100%);
            background-size: 400% 400%;
            animation: netflixGradientSubtle 15s ease infinite;
            min-height: 100vh;
            color: #ffffff;
        }
        
        @keyframes netflixGradientSubtle {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .netflix-card {
            background: linear-gradient(145deg, rgba(45,45,45,0.98) 0%, rgba(35,35,35,0.98) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100,100,100,0.4);
            box-shadow: 0 8px 32px rgba(0,0,0,0.7);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .netflix-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.9);
            border-color: rgba(120,120,120,0.6);
        }
        
        .netflix-header {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 50%, #2a2a2a 100%);
            border-bottom: 2px solid #444;
            position: relative;
        }
        
        .netflix-tab {
            background: linear-gradient(145deg, rgba(70,70,70,0.9) 0%, rgba(50,50,50,0.9) 100%);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(120,120,120,0.3);
            color: #ffffff;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .netflix-tab:hover {
            background: linear-gradient(145deg, rgba(90,90,90,0.95) 0%, rgba(70,70,70,0.95) 100%);
            border-color: rgba(140,140,140,0.5);
            transform: translateY(-1px);
        }
        
        .netflix-tab.active {
            background: linear-gradient(145deg, #e50914 0%, #b20710 100%);
            border-color: #e50914;
            box-shadow: 0 0 20px rgba(229,9,20,0.4);
            color: #ffffff;
        }
        
        .netflix-button {
            background: linear-gradient(145deg, #444 0%, #333 100%);
            border: 1px solid #666;
            color: #ffffff;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .netflix-button:hover {
            background: linear-gradient(145deg, #555 0%, #444 100%);
            border-color: #777;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        
        /* Bot√µes de RECOMPENSA - S√≥ ativam quando necess√°rio */
        .netflix-reward-button {
            background: linear-gradient(145deg, #e50914 0%, #b20710 100%);
            border: none;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow: 0 0 30px rgba(229,9,20,0.5);
            animation: rewardPulse 2s ease-in-out infinite;
        }
        
        @keyframes rewardPulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(229,9,20,0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 50px rgba(229,9,20,0.8);
                transform: scale(1.02);
            }
        }
        
        .netflix-reward-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: rewardShine 2s linear infinite;
        }
        
        @keyframes rewardShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .netflix-reward-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(229,9,20,0.7);
        }
        
        .netflix-input {
            background: rgba(70,70,70,0.9);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(120,120,120,0.4);
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .netflix-input:focus {
            border-color: #e50914;
            box-shadow: 0 0 15px rgba(229,9,20,0.3);
            background: rgba(80,80,80,0.95);
        }
        
        .netflix-input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .netflix-text {
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        
        .netflix-text-muted {
            color: #cccccc;
        }
        
        .netflix-text-bright {
            color: #ffffff;
            font-weight: 500;
        }
        
        /* Cards de d√≠vida com indicadores visuais claros */
        .netflix-divida-card {
            background: linear-gradient(145deg, rgba(50,50,50,0.98) 0%, rgba(40,40,40,0.98) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100,100,100,0.5);
            transition: all 0.3s ease;
        }
        
        .netflix-divida-card.deve {
            border-left: 4px solid #e50914;
            background: linear-gradient(145deg, rgba(229,9,20,0.15) 0%, rgba(50,50,50,0.98) 100%);
        }
        
        .netflix-divida-card.credito {
            border-left: 4px solid #00d4aa;
            background: linear-gradient(145deg, rgba(0,212,170,0.15) 0%, rgba(50,50,50,0.98) 100%);
        }
        
        .netflix-divida-card.em-dia {
            border-left: 4px solid #46d369;
            background: linear-gradient(145deg, rgba(70,211,105,0.15) 0%, rgba(50,50,50,0.98) 100%);
        }
        
        /* Part√≠culas sutis - s√≥ aparecem em momentos de conquista */
        .netflix-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .netflix-particles.active {
            opacity: 1;
        }
        
        .netflix-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, #e50914, transparent);
            border-radius: 50%;
            animation: netflixParticleFloat 6s linear infinite;
        }
        
        @keyframes netflixParticleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .netflix-reveal {
            opacity: 0;
            transform: translateY(20px);
            animation: netflixReveal 0.6s ease-out forwards;
        }
        
        @keyframes netflixReveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Efeitos de conquista - s√≥ ativam quando completa tarefas */
        .netflix-achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(145deg, #e50914 0%, #b20710 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 20px 60px rgba(229,9,20,0.5);
            z-index: 1000;
            animation: achievementPop 2s ease-out;
        }
        
        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }
        
        /* Melhor legibilidade */
        .netflix-mode h1, .netflix-mode h2, .netflix-mode h3, .netflix-mode h4 {
            color: #ffffff;
            font-weight: 600;
        }
        
        .netflix-mode p, .netflix-mode span, .netflix-mode div {
            color: #e5e5e5;
        }
        
        .netflix-mode .text-gray-500 {
            color: #a5a5a5 !important;
        }
        
        .netflix-mode .text-gray-600 {
            color: #b5b5b5 !important;
        }
        
        .netflix-mode .text-gray-700 {
            color: #c5c5c5 !important;
        }
        
        .netflix-mode .text-gray-800 {
            color: #e5e5e5 !important;
        }
        
        /* Indicadores de progresso dopamin√©rgicos */
        .netflix-progress-bar {
            background: rgba(60,60,60,0.8);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }
        
        .netflix-progress-fill {
            background: linear-gradient(90deg, #e50914, #ff6b6b);
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s ease;
            position: relative;
        }
        
        .netflix-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s linear infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Temas de cores */
        .tema-verde-azul .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #0891b2 100%);
        }
        
        .tema-verde-azul .gradient-bg {
            background: linear-gradient(135deg, #10b981 0%, #0891b2 100%);
        }
        
        .tema-laranja-rosa .btn-primary {
            background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
        }
        
        .tema-laranja-rosa .gradient-bg {
            background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
        }
        
        .tema-escuro {
            background: #1f2937;
            color: #f9fafb;
        }
        
        .tema-escuro .bg-white {
            background: #374151 !important;
            color: #f9fafb;
        }
        
        .tema-escuro .text-gray-800 {
            color: #f9fafb !important;
        }
        
        .tema-escuro .border-gray-200 {
            border-color: #4b5563 !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg relative">
        <div class="container mx-auto px-6">
            <h1 class="text-3xl font-bold text-center">Sistema de Vendas Profissional</h1>
            <p class="text-center mt-2 opacity-90">Automatiza√ß√£o completa do seu neg√≥cio</p>
            
            <!-- Bot√µes do Header -->
            <div class="absolute top-4 right-4 flex space-x-2">
                <!-- Bot√£o Modo Foco -->
                <button onclick="modoFocoAtivo ? desativarModoFoco() : ativarModoFoco()" 
                    id="btn-modo-foco"
                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-2 transition-all duration-300 hover:scale-110 group">
                    <svg class="w-5 h-5 text-white transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                </button>
                
                <!-- Bot√£o de Configura√ß√µes -->
                <button onclick="abrirConfiguracoes()" 
                    class="bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-2 transition-all duration-300 hover:scale-110 group">
                    <svg class="w-5 h-5 text-white group-hover:rotate-90 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Indicador de Modo Foco -->
            <div id="indicador-modo-foco" class="absolute top-16 right-4 bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium hidden animate-pulse">
                üéØ Modo Foco Ativo
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto py-4">
                <button onclick="showTab('vendas')" id="tab-vendas" class="tab-active px-6 py-3 rounded-lg font-medium whitespace-nowrap transition-all">
                    üìä Vendas do Dia
                </button>
                <button onclick="showTab('produtos')" id="tab-produtos" class="px-6 py-3 rounded-lg font-medium whitespace-nowrap hover:bg-gray-100 transition-all">
                    üõçÔ∏è Produtos
                </button>
                <button onclick="showTab('clientes')" id="tab-clientes" class="px-6 py-3 rounded-lg font-medium whitespace-nowrap hover:bg-gray-100 transition-all">
                    üë• Clientes
                </button>
                <button onclick="showTab('dividas')" id="tab-dividas" class="px-6 py-3 rounded-lg font-medium whitespace-nowrap hover:bg-gray-100 transition-all">
                    üí∞ D√≠vidas
                </button>
                <button onclick="showTab('relatorios')" id="tab-relatorios" class="px-6 py-3 rounded-lg font-medium whitespace-nowrap hover:bg-gray-100 transition-all">
                    üìà Relat√≥rios
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- Vendas do Dia Tab -->
        <div id="vendas-tab" class="tab-content">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Modo de Entrada -->
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üìù Registrar Vendas</h2>
                    
                    <div class="mb-6">
                        <div class="flex space-x-4 mb-4">
                            <button onclick="setInputMode('chat')" id="mode-chat" class="btn-primary px-4 py-2 rounded-lg text-white font-medium">
                                üí¨ Modo Chat
                            </button>
                            <button onclick="setInputMode('individual')" id="mode-individual" class="px-4 py-2 rounded-lg border-2 border-gray-300 font-medium hover:bg-gray-50">
                                ‚ûï Venda Individual
                            </button>
                        </div>
                    </div>

                    <!-- Modo Chat -->
                    <div id="chat-mode" class="input-mode">
                        <!-- Guia de formato -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-blue-800 mb-2">üìù Formato Aceito:</h4>
                            <div class="text-sm text-blue-700 space-y-1">
                                <div><code class="bg-blue-100 px-2 py-1 rounded">Nome Quantidade Produto [PAGO] [Valor]</code></div>
                                <div class="text-xs text-blue-600 mt-2">
                                    <strong>Exemplos:</strong><br>
                                    ‚Ä¢ <code>Jo√£o 2 brigadeiro chocolate</code> (fiado)<br>
                                    ‚Ä¢ <code>Maria 1 coxinha PAGO</code> (pago total)<br>
                                    ‚Ä¢ <code>Pedro 3 trufa morango PAGO 15.50</code> (valor espec√≠fico)
                                </div>
                            </div>
                        </div>

                        <!-- Bot√£o de IA -->
                        <div class="mb-4">
                            <button onclick="copiarPromptIA()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center space-x-2 transition-colors">
                                <span>ü§ñ</span>
                                <span>Copiar Prompt para IA Formatar</span>
                            </button>
                            <div class="text-xs text-gray-500 mt-1">Clique para copiar um prompt que voc√™ pode usar em qualquer IA para formatar suas vendas</div>
                        </div>

                        <textarea id="chat-input" placeholder="Cole aqui o texto formatado pela IA ou digite manualmente no formato acima..." 
                                class="w-full h-32 p-4 border-2 rounded-lg input-focus resize-none" rows="6"></textarea>
                        <button onclick="processarVendasChat()" class="btn-primary w-full mt-4 py-3 rounded-lg text-white font-medium">
                            üöÄ Processar Vendas
                        </button>
                    </div>

                    <!-- Modo Individual -->
                    <div id="individual-mode" class="input-mode hidden">
                        <div class="space-y-4">
                            <div class="relative">
                                <label class="block text-sm font-medium mb-2">Cliente</label>
                                <input type="text" id="cliente-individual" placeholder="Digite o nome do cliente..." 
                                    class="w-full p-3 border-2 rounded-lg input-focus" 
                                    oninput="buscarClientesInteligente(this.value)"
                                    onblur="setTimeout(() => ocultarSugestoesClientes(), 200)"
                                    onfocus="mostrarSugestoesClientes()"
                                    autocomplete="off">
                                
                                <!-- Dropdown de sugest√µes de clientes -->
                                <div id="sugestoes-clientes-dropdown" class="absolute top-full left-0 right-0 bg-white border-2 border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                    <!-- Sugest√µes aparecer√£o aqui -->
                                </div>
                            </div>
                            
                            <!-- Lista de produtos para o cliente atual -->
                            <div id="produtos-cliente-atual" class="space-y-3">
                                <!-- Produtos ser√£o adicionados aqui dinamicamente -->
                            </div>
                            
                            <!-- Formul√°rio para adicionar produto -->
                            <div class="bg-gray-50 p-4 rounded-lg border-2 border-dashed border-gray-300">
                                <h4 class="font-medium mb-3">‚ûï Adicionar Produto</h4>
                                <div class="grid grid-cols-2 gap-4 mb-3">
                                    <div class="relative">
                                        <label class="block text-sm font-medium mb-1">Produto</label>
                                        <input type="text" id="produto-busca-individual" placeholder="Digite o nome do produto..." 
                                            class="w-full p-2 border-2 rounded-lg input-focus" 
                                            oninput="buscarProdutosInteligente(this.value)"
                                            onblur="setTimeout(() => ocultarSugestoesProdutos(), 200)"
                                            onfocus="mostrarSugestoesProdutos()"
                                            autocomplete="off">
                                        
                                        <!-- Dropdown de sugest√µes -->
                                        <div id="sugestoes-produtos-dropdown" class="absolute top-full left-0 right-0 bg-white border-2 border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto hidden">
                                            <!-- Sugest√µes aparecer√£o aqui -->
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Sabor</label>
                                        <select id="sabor-individual" class="w-full p-2 border-2 rounded-lg input-focus" disabled>
                                            <option value="">Selecione primeiro o produto</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 mb-3">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Quantidade</label>
                                        <input type="number" id="quantidade-individual" placeholder="1" min="1" value="1"
                                            class="w-full p-2 border-2 rounded-lg input-focus"
                                            oninput="calcularStatusAutomatico()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Pre√ßo Unit√°rio</label>
                                        <input type="text" id="preco-unitario-display" readonly
                                            class="w-full p-2 border-2 rounded-lg bg-gray-100 text-gray-600" 
                                            placeholder="R$ 0,00">
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 mb-3">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Status <span class="text-xs text-gray-500">(autom√°tico)</span></label>
                                        <input type="text" id="status-display" readonly
                                            class="w-full p-2 border-2 rounded-lg bg-gray-100 text-gray-600 font-medium" 
                                            value="üìù FIADO">
                                        <input type="hidden" id="status-individual" value="fiado">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Valor Pago <span class="text-xs text-gray-500">(deixe vazio = fiado)</span></label>
                                        <input type="number" id="valor-individual" placeholder="0.00" step="0.01" 
                                            class="w-full p-2 border-2 rounded-lg input-focus"
                                            oninput="calcularStatusAutomatico()">
                                    </div>
                                </div>
                                <button onclick="adicionarProdutoCliente()" class="btn-primary w-full py-2 rounded-lg text-white font-medium">
                                    ‚ûï Adicionar Produto
                                </button>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button onclick="finalizarVendaIndividual()" class="btn-primary flex-1 py-3 rounded-lg text-white font-medium">
                                    ‚úÖ Finalizar Venda
                                </button>
                                <button onclick="limparVendaIndividual()" class="border-2 border-gray-300 px-6 py-3 rounded-lg font-medium hover:bg-gray-50">
                                    üóëÔ∏è Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vendas do Dia -->
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üìã Vendas de Hoje</h2>
                    <div id="vendas-hoje" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-8">Nenhuma venda registrada hoje</p>
                    </div>
                    <div class="mt-6 pt-4 border-t">
                        <button onclick="finalizarDia()" class="btn-primary w-full py-3 rounded-lg text-white font-medium">
                            ‚úÖ Finalizar Dia e Atualizar D√≠vidas
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pagamentos Avulsos -->
            <div class="mt-8 bg-white rounded-xl card-shadow p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">üí≥ Pagamentos Avulsos</h2>
                <div class="grid md:grid-cols-3 gap-4">
                    <input type="text" id="pagamento-cliente" placeholder="Nome do cliente" 
                        class="p-3 border-2 rounded-lg input-focus" list="clientes-list">
                    <input type="number" id="pagamento-valor" placeholder="Valor pago" step="0.01" 
                        class="p-3 border-2 rounded-lg input-focus">
                    <button onclick="adicionarPagamento()" class="btn-primary py-3 rounded-lg text-white font-medium">
                        üí∞ Adicionar Pagamento
                    </button>
                </div>
                <div id="pagamentos-avulsos" class="mt-4 space-y-2"></div>
            </div>
        </div>

        <!-- Produtos Tab -->
        <div id="produtos-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">‚ûï Cadastrar Produto</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nome do Produto</label>
                            <input type="text" id="produto-nome" placeholder="Ex: Brigadeiro" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Pre√ßo</label>
                                <input type="number" id="produto-preco" placeholder="0.00" step="0.01" 
                                    class="w-full p-3 border-2 rounded-lg input-focus">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Categoria</label>
                                <select id="produto-categoria" class="w-full p-3 border-2 rounded-lg input-focus">
                                    <option value="doces">Doces</option>
                                    <option value="salgados">Salgados</option>
                                    <option value="chiclete">Chiclete</option>
                                    <option value="bebidas">Bebidas</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Sabores (separados por v√≠rgula)</label>
                            <input type="text" id="produto-sabores" placeholder="Ex: chocolate, morango, baunilha" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Tags/Abrevia√ß√µes (separadas por v√≠rgula)</label>
                            <input type="text" id="produto-tags" placeholder="Ex: brig, brigadeirinho, doce" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <button onclick="cadastrarProduto()" class="btn-primary w-full py-3 rounded-lg text-white font-medium">
                            ‚úÖ Cadastrar Produto
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üì¶ Produtos Cadastrados</h2>
                    <div id="lista-produtos" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-8">Nenhum produto cadastrado</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes Tab -->
        <div id="clientes-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üë§ Cadastrar Cliente</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nome Completo</label>
                            <input type="text" id="cliente-nome" placeholder="Ex: Jo√£o Silva" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">N√∫mero de Celular</label>
                            <input type="tel" id="cliente-celular" placeholder="(11) 99999-9999" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Apelidos/Tags (separados por v√≠rgula)</label>
                            <input type="text" id="cliente-tags" placeholder="Ex: Jo√£o, Jo√£ozinho, J" 
                                class="w-full p-3 border-2 rounded-lg input-focus">
                        </div>
                        <button onclick="cadastrarCliente()" class="btn-primary w-full py-3 rounded-lg text-white font-medium">
                            ‚úÖ Cadastrar Cliente
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üë• Clientes Cadastrados</h2>
                    <div id="lista-clientes" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-8">Nenhum cliente cadastrado</p>
                    </div>
                </div>
            </div>

            <!-- Clientes Pendentes -->
            <div id="clientes-pendentes-section" class="mt-8 bg-yellow-50 rounded-xl border-2 border-yellow-200 p-6 hidden">
                <h2 class="text-2xl font-bold mb-6 text-yellow-800">‚è≥ Clientes Pendentes de Cadastro</h2>
                <div id="lista-clientes-pendentes" class="space-y-3 mb-4">
                    <!-- Clientes pendentes aparecer√£o aqui -->
                </div>
                <button onclick="limparClientesPendentes()" class="text-yellow-700 hover:text-yellow-900 font-medium">
                    üóëÔ∏è Limpar Lista
                </button>
            </div>
        </div>

        <!-- D√≠vidas Tab -->
        <div id="dividas-tab" class="tab-content hidden">
            <!-- Header com gradiente e estat√≠sticas -->
            <div class="bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 rounded-2xl p-8 mb-8 text-white shadow-2xl">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h2 class="text-4xl font-bold mb-2 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">
                            üíé Controle Financeiro
                        </h2>
                        <p class="text-blue-100 text-lg">Gest√£o inteligente de d√≠vidas e cr√©ditos</p>
                    </div>
                    <div class="text-right">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 border border-white/30">
                            <div class="text-sm text-blue-100 mb-1">√öltima Atualiza√ß√£o</div>
                            <div class="text-white font-medium" id="ultima-atualizacao">Nunca</div>
                        </div>
                    </div>
                </div>
                
                <!-- Cards de estat√≠sticas com anima√ß√µes -->
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-red-500 to-pink-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl hover:shadow-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üìä</span>
                            </div>
                            <div class="text-right">
                                <div class="text-red-100 text-sm">Total em</div>
                                <div class="text-white font-bold">D√çVIDAS</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="total-dividas">R$ 0,00</div>
                        <div class="text-red-100 text-sm">Valores a receber</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl hover:shadow-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">‚úÖ</span>
                            </div>
                            <div class="text-right">
                                <div class="text-green-100 text-sm">Clientes</div>
                                <div class="text-white font-bold">EM DIA</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="clientes-em-dia">0</div>
                        <div class="text-green-100 text-sm">Sem pend√™ncias</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl hover:shadow-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üí∞</span>
                            </div>
                            <div class="text-right">
                                <div class="text-blue-100 text-sm">Cr√©ditos</div>
                                <div class="text-white font-bold">DISPON√çVEIS</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="total-creditos">R$ 0,00</div>
                        <div class="text-blue-100 text-sm">Saldo positivo</div>
                    </div>
                </div>
            </div>

            <!-- Lista de clientes com design profissional -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 border-b border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">üë• Situa√ß√£o dos Clientes</h3>
                    <p class="text-gray-600">Acompanhe o status financeiro de cada cliente</p>
                </div>
                
                <div id="lista-dividas" class="p-6">
                    <div class="flex items-center justify-center py-16">
                        <div class="text-center">
                            <div class="text-6xl mb-4">üí≥</div>
                            <p class="text-gray-500 text-lg">Nenhuma d√≠vida registrada</p>
                            <p class="text-gray-400 text-sm mt-2">As informa√ß√µes aparecer√£o aqui ap√≥s finalizar o dia</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios Tab -->
        <div id="relatorios-tab" class="tab-content hidden">
            <!-- Header com estat√≠sticas principais -->
            <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-blue-700 rounded-2xl p-8 mb-8 text-white shadow-2xl">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h2 class="text-4xl font-bold mb-2 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">
                            üìä Relat√≥rios Executivos
                        </h2>
                        <p class="text-blue-100 text-lg">An√°lise completa do seu neg√≥cio</p>
                    </div>
                    <div class="text-right">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 border border-white/30">
                            <div class="text-sm text-blue-100 mb-1">Atualizado em</div>
                            <div class="text-white font-medium" id="relatorio-ultima-atualizacao">Tempo real</div>
                        </div>
                    </div>
                </div>
                
                <!-- Filtros de per√≠odo -->
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-white/20">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-white">üìÖ Per√≠odo de An√°lise</h3>
                        <div class="text-sm text-blue-100" id="periodo-selecionado-info">Hoje</div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filtrarRelatorio('hoje')" id="filtro-hoje" class="filtro-periodo-ativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üìÖ Hoje
                        </button>
                        <button onclick="filtrarRelatorio('ontem')" id="filtro-ontem" class="filtro-periodo-inativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üìÖ Ontem
                        </button>
                        <button onclick="filtrarRelatorio('7dias')" id="filtro-7dias" class="filtro-periodo-inativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üìä √öltimos 7 dias
                        </button>
                        <button onclick="filtrarRelatorio('15dias')" id="filtro-15dias" class="filtro-periodo-inativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üìä √öltimas 2 semanas
                        </button>
                        <button onclick="filtrarRelatorio('30dias')" id="filtro-30dias" class="filtro-periodo-inativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üìä √öltimo m√™s
                        </button>
                        <button onclick="filtrarRelatorio('personalizado')" id="filtro-personalizado" class="filtro-periodo-inativo px-4 py-2 rounded-lg text-sm font-medium transition-all">
                            üéØ Personalizado
                        </button>
                    </div>
                    
                    <!-- Seletor de per√≠odo personalizado -->
                    <div id="periodo-personalizado" class="hidden mt-4 grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-blue-100 mb-1">Data Inicial</label>
                            <input type="date" id="data-inicial" class="w-full p-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-blue-200">
                        </div>
                        <div>
                            <label class="block text-sm text-blue-100 mb-1">Data Final</label>
                            <input type="date" id="data-final" class="w-full p-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-blue-200">
                        </div>
                    </div>
                </div>
                
                <!-- Cards de m√©tricas principais -->
                <div class="grid md:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üí∞</span>
                            </div>
                            <div class="text-right">
                                <div class="text-green-100 text-sm">Faturamento</div>
                                <div class="text-white font-bold">HOJE</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="faturamento-hoje">R$ 0,00</div>
                        <div class="text-green-100 text-sm">Total vendido</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üí≥</span>
                            </div>
                            <div class="text-right">
                                <div class="text-blue-100 text-sm">Recebido</div>
                                <div class="text-white font-bold">√Ä VISTA</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="recebido-vista-relatorio">R$ 0,00</div>
                        <div class="text-blue-100 text-sm">Dinheiro em caixa</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üìù</span>
                            </div>
                            <div class="text-right">
                                <div class="text-orange-100 text-sm">Vendido</div>
                                <div class="text-white font-bold">FIADO</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="vendido-fiado-relatorio">R$ 0,00</div>
                        <div class="text-orange-100 text-sm">A receber</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl p-6 transform hover:scale-105 transition-all duration-300 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="bg-white/20 rounded-full p-3">
                                <span class="text-2xl">üõçÔ∏è</span>
                            </div>
                            <div class="text-right">
                                <div class="text-purple-100 text-sm">Total</div>
                                <div class="text-white font-bold">VENDAS</div>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="total-vendas-relatorio">0</div>
                        <div class="text-purple-100 text-sm">Transa√ß√µes hoje</div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de an√°lises detalhadas -->
            <div class="grid lg:grid-cols-2 gap-8 mb-8">
                <!-- Produtos mais vendidos -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-6 py-4">
                        <h3 class="text-xl font-bold text-white flex items-center">
                            <span class="mr-3">üéØ</span>
                            Top Produtos Hoje
                        </h3>
                    </div>
                    <div class="p-6">
                        <div id="produtos-mais-vendidos-relatorio" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <div class="text-4xl mb-2">üì¶</div>
                                <p>Nenhuma venda registrada hoje</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Clientes mais ativos -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4">
                        <h3 class="text-xl font-bold text-white flex items-center">
                            <span class="mr-3">üë•</span>
                            Clientes Mais Ativos
                        </h3>
                    </div>
                    <div class="p-6">
                        <div id="clientes-mais-ativos" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <div class="text-4xl mb-2">üë§</div>
                                <p>Nenhuma venda registrada hoje</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- An√°lise de performance -->
            <div class="grid lg:grid-cols-3 gap-8 mb-8">
                <!-- An√°lise de pagamentos -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-blue-100 p-2 rounded-full mr-3">üí≥</span>
                        An√°lise de Pagamentos
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <span class="text-green-700 font-medium">Pagamentos √† Vista</span>
                            <span class="text-green-800 font-bold" id="pagamentos-vista-count">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                            <span class="text-yellow-700 font-medium">Pagamentos Parciais</span>
                            <span class="text-yellow-800 font-bold" id="pagamentos-parciais-count">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                            <span class="text-red-700 font-medium">Vendas Fiadas</span>
                            <span class="text-red-800 font-bold" id="vendas-fiadas-count">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <span class="text-blue-700 font-medium">Pagamentos Avulsos</span>
                            <span class="text-blue-800 font-bold" id="pagamentos-avulsos-count">0</span>
                        </div>
                    </div>
                </div>

                <!-- An√°lise de categorias -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-purple-100 p-2 rounded-full mr-3">üìä</span>
                        Vendas por Categoria
                    </h3>
                    <div id="vendas-por-categoria" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-3xl mb-2">üìà</div>
                            <p class="text-sm">Dados aparecer√£o ap√≥s vendas</p>
                        </div>
                    </div>
                </div>

                <!-- M√©tricas de efici√™ncia -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-orange-100 p-2 rounded-full mr-3">‚ö°</span>
                        M√©tricas de Efici√™ncia
                    </h3>
                    <div class="space-y-4">
                        <div class="text-center p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="ticket-medio">R$ 0,00</div>
                            <div class="text-sm text-gray-600">Ticket M√©dio</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="taxa-pagamento">0%</div>
                            <div class="text-sm text-gray-600">Taxa de Pagamento √† Vista</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg">
                            <div class="text-2xl font-bold text-orange-600" id="clientes-atendidos">0</div>
                            <div class="text-sm text-gray-600">Clientes Atendidos</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico de performance -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="bg-gradient-to-r from-gray-700 to-gray-900 px-6 py-4">
                    <h3 class="text-xl font-bold text-white flex items-center">
                        <span class="mr-3">üìà</span>
                        Hist√≥rico de Performance (√öltimos 7 Dias)
                    </h3>
                </div>
                <div class="p-6">
                    <div id="historico-performance" class="space-y-4">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üìä</div>
                            <p>Hist√≥rico ser√° constru√≠do conforme voc√™ usar o sistema</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Cliente N√£o Cadastrado -->
    <div id="modal-cliente" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">Cliente n√£o encontrado</h3>
            <p class="mb-4">O cliente "<span id="cliente-nao-encontrado"></span>" n√£o est√° cadastrado. Deseja cadastr√°-lo?</p>
            <div class="space-y-3">
                <input type="tel" id="modal-celular" placeholder="N√∫mero de celular" 
                    class="w-full p-3 border-2 rounded-lg input-focus">
                <input type="text" id="modal-tags" placeholder="Apelidos/tags (opcional)" 
                    class="w-full p-3 border-2 rounded-lg input-focus">
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="cadastrarClienteModal()" class="btn-primary flex-1 py-2 rounded-lg text-white font-medium">
                    Cadastrar
                </button>
                <button onclick="fecharModal()" class="border-2 border-gray-300 flex-1 py-2 rounded-lg font-medium hover:bg-gray-50">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Perfil do Cliente -->
    <div id="modal-perfil" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="perfil-nome">Perfil do Cliente</h3>
                <button onclick="fecharPerfilModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h4 class="font-semibold mb-2">Informa√ß√µes</h4>
                    <p><strong>Celular:</strong> <span id="perfil-celular"></span></p>
                    <p><strong>D√≠vida Atual:</strong> <span id="perfil-divida" class="font-bold"></span></p>
                    <p><strong>Tags:</strong> <span id="perfil-tags"></span></p>
                </div>
                <div class="text-center">
                    <button onclick="enviarWhatsApp()" id="btn-whatsapp" class="btn-primary px-6 py-3 rounded-lg text-white font-medium mb-2 w-full">
                        üì± Enviar WhatsApp
                    </button>
                    <div class="text-xs text-gray-500">Mensagem autom√°tica ser√° enviada</div>
                </div>
            </div>

            <div>
                <h4 class="font-semibold mb-4">üìà Hist√≥rico de Compras</h4>
                <div id="perfil-historico" class="space-y-3 max-h-60 overflow-y-auto">
                    <p class="text-gray-500 text-center py-4">Nenhuma compra registrada</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Produto -->
    <div id="modal-editar-produto" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚úèÔ∏è Editar Produto</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Nome do Produto</label>
                    <input type="text" id="editar-produto-nome" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Pre√ßo</label>
                        <input type="number" id="editar-produto-preco" step="0.01" class="w-full p-3 border-2 rounded-lg input-focus">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Categoria</label>
                        <select id="editar-produto-categoria" class="w-full p-3 border-2 rounded-lg input-focus">
                            <option value="doces">Doces</option>
                            <option value="salgados">Salgados</option>
                            <option value="chiclete">Chiclete</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Sabores (separados por v√≠rgula)</label>
                    <input type="text" id="editar-produto-sabores" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Tags/Abrevia√ß√µes (separadas por v√≠rgula)</label>
                    <input type="text" id="editar-produto-tags" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="salvarEdicaoProduto()" class="btn-primary flex-1 py-2 rounded-lg text-white font-medium">
                    ‚úÖ Salvar
                </button>
                <button onclick="fecharModalEditarProduto()" class="border-2 border-gray-300 flex-1 py-2 rounded-lg font-medium hover:bg-gray-50">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Cliente -->
    <div id="modal-editar-cliente" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚úèÔ∏è Editar Cliente</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Nome Completo</label>
                    <input type="text" id="editar-cliente-nome" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">N√∫mero de Celular</label>
                    <input type="tel" id="editar-cliente-celular" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Apelidos/Tags (separados por v√≠rgula)</label>
                    <input type="text" id="editar-cliente-tags" class="w-full p-3 border-2 rounded-lg input-focus">
                </div>
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="salvarEdicaoCliente()" class="btn-primary flex-1 py-2 rounded-lg text-white font-medium">
                    ‚úÖ Salvar
                </button>
                <button onclick="fecharModalEditarCliente()" class="border-2 border-gray-300 flex-1 py-2 rounded-lg font-medium hover:bg-gray-50">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes Avan√ßadas -->
    <div id="modal-configuracoes" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden shadow-2xl">
            <!-- Header do Modal -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold mb-2">‚öôÔ∏è Configura√ß√µes Avan√ßadas</h3>
                        <p class="text-purple-100">Personalize seu sistema para m√°ximo conforto</p>
                    </div>
                    <button onclick="fecharConfiguracoes()" class="text-white hover:text-purple-200 text-3xl transition-colors">
                        &times;
                    </button>
                </div>
            </div>
            
            <!-- Conte√∫do do Modal -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- Abas de Configura√ß√£o -->
                <div class="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg">
                    <button onclick="mostrarConfigTab('whatsapp')" id="config-tab-whatsapp" 
                        class="config-tab-active flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-all">
                        üì± WhatsApp
                    </button>
                    <button onclick="mostrarConfigTab('visual')" id="config-tab-visual" 
                        class="config-tab-inactive flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-all">
                        üé® Visual
                    </button>
                    <button onclick="mostrarConfigTab('sistema')" id="config-tab-sistema" 
                        class="config-tab-inactive flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-all">
                        ‚öôÔ∏è Sistema
                    </button>
                    <button onclick="mostrarConfigTab('dados')" id="config-tab-dados" 
                        class="config-tab-inactive flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-all">
                        üíæ Dados
                    </button>
                </div>

                <!-- Configura√ß√µes WhatsApp -->
                <div id="config-whatsapp" class="config-content">
                    <div class="space-y-6">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-3">üì± Personaliza√ß√£o de Mensagens</h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Modelo de Mensagem Principal</label>
                                    <textarea id="config-mensagem-principal" rows="8" 
                                        class="w-full p-3 border-2 rounded-lg input-focus font-mono text-sm"
                                        placeholder="*ATUALIZA√á√ÉO DA CONTA* _{hora}_
tava {dividaAnterior}

{data}
{produtos}
{pagamentos}

*TOTAL={dividaTotal}*"></textarea>
                                    <div class="text-xs text-gray-600 mt-2">
                                        <strong>Vari√°veis dispon√≠veis:</strong> {hora}, {dividaAnterior}, {data}, {produtos}, {pagamentos}, {dividaTotal}
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Incluir Hora</label>
                                        <select id="config-incluir-hora" class="w-full p-2 border-2 rounded-lg input-focus">
                                            <option value="true">Sim</option>
                                            <option value="false">N√£o</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Formato de Data</label>
                                        <select id="config-formato-data" class="w-full p-2 border-2 rounded-lg input-focus">
                                            <option value="dd/mm">DD/MM</option>
                                            <option value="dd/mm/yyyy">DD/MM/AAAA</option>
                                            <option value="texto">Por extenso</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Mostrar Valores Mesmo com D√≠vida Zero</label>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="mostrar-divida-zero" value="true" checked 
                                                class="mr-2"> Sim, sempre mostrar
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="mostrar-divida-zero" value="false" 
                                                class="mr-2"> N√£o mostrar se zero
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-800 mb-3">‚úÖ Teste de Mensagem</h4>
                            <button onclick="testarMensagemWhatsApp()" 
                                class="btn-primary px-4 py-2 rounded-lg text-white font-medium">
                                üì± Visualizar Exemplo
                            </button>
                            <div id="preview-mensagem" class="mt-3 p-3 bg-white rounded border hidden">
                                <!-- Preview aparecer√° aqui -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes Visuais -->
                <div id="config-visual" class="config-content hidden">
                    <div class="space-y-6">
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-800 mb-3">üé® Tema e Cores</h4>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Tema Principal</label>
                                    <select id="config-tema" class="w-full p-2 border-2 rounded-lg input-focus">
                                        <option value="roxo-azul">Roxo/Azul (Padr√£o)</option>
                                        <option value="verde-azul">Verde/Azul</option>
                                        <option value="laranja-rosa">Laranja/Rosa</option>
                                        <option value="escuro">Modo Escuro</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Intensidade das Anima√ß√µes</label>
                                    <select id="config-animacoes" class="w-full p-2 border-2 rounded-lg input-focus">
                                        <option value="alta">Alta (Padr√£o)</option>
                                        <option value="media">M√©dia</option>
                                        <option value="baixa">Baixa</option>
                                        <option value="nenhuma">Sem Anima√ß√µes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-pink-50 p-4 rounded-lg border border-pink-200">
                            <h4 class="font-bold text-pink-800 mb-3">üíé Efeitos Neuroci√™ncia</h4>
                            
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="config-efeito-dopamina" checked class="mr-3">
                                    <span>Efeitos de dopamina (cores vibrantes, micro-anima√ß√µes)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="config-sons-feedback" class="mr-3">
                                    <span>Sons de feedback (cliques, sucessos)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="config-particulas" class="mr-3">
                                    <span>Efeitos de part√≠culas em a√ß√µes importantes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="config-modo-netflix" class="mr-3">
                                    <span class="font-bold text-red-600">üî• MODO NETFLIX (Ultra Viciante)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800 mb-3">üî• Modo Netflix - Produtividade Estrat√©gica</h4>
                            <p class="text-sm text-red-700 mb-3">
                                Modo escuro profissional com recompensas dopamin√©rgicas estrat√©gicas. 
                                Efeitos visuais aparecem apenas quando voc√™ completa tarefas importantes, 
                                incentivando produtividade atrav√©s de conquistas e feedback positivo.
                            </p>
                            <div class="text-xs text-red-600 mb-3">
                                ‚ú® Recompensas ativam em: cadastros, processamento de vendas, finaliza√ß√£o do dia
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="ativarModoNetflix()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm font-medium">
                                    üî• Ativar Modo Netflix
                                </button>
                                <button onclick="desativarModoNetflix()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm font-medium">
                                    üåô Voltar ao Normal
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes do Sistema -->
                <div id="config-sistema" class="config-content hidden">
                    <div class="space-y-6">
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-bold text-yellow-800 mb-3">‚öôÔ∏è Comportamento do Sistema</h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Auto-salvar dados a cada</label>
                                    <select id="config-auto-save" class="w-full p-2 border-2 rounded-lg input-focus">
                                        <option value="30">30 segundos</option>
                                        <option value="60" selected>1 minuto</option>
                                        <option value="300">5 minutos</option>
                                        <option value="0">Desabilitado</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Confirma√ß√£o para exclus√µes</label>
                                    <select id="config-confirmacao-exclusao" class="w-full p-2 border-2 rounded-lg input-focus">
                                        <option value="sempre" selected>Sempre confirmar</option>
                                        <option value="importantes">Apenas itens importantes</option>
                                        <option value="nunca">Nunca confirmar</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Limite de resultados na busca</label>
                                    <input type="number" id="config-limite-busca" value="8" min="3" max="20" 
                                        class="w-full p-2 border-2 rounded-lg input-focus">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes de Dados -->
                <div id="config-dados" class="config-content hidden">
                    <div class="space-y-6">
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h4 class="font-bold text-red-800 mb-3">üíæ Backup e Restaura√ß√£o</h4>
                            
                            <div class="space-y-4">
                                <div class="flex space-x-3">
                                    <button onclick="exportarDados()" 
                                        class="btn-primary px-4 py-2 rounded-lg text-white font-medium">
                                        üì• Exportar Dados
                                    </button>
                                    <button onclick="document.getElementById('import-file').click()" 
                                        class="btn-secondary px-4 py-2 rounded-lg text-white font-medium">
                                        üì§ Importar Dados
                                    </button>
                                    <input type="file" id="import-file" accept=".json" class="hidden" onchange="importarDados(event)">
                                </div>
                                
                                <div class="text-sm text-gray-600">
                                    <p><strong>Exportar:</strong> Salva todos os dados em um arquivo JSON</p>
                                    <p><strong>Importar:</strong> Restaura dados de um backup anterior</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h4 class="font-bold text-gray-800 mb-3">üóëÔ∏è Limpeza de Dados</h4>
                            
                            <div class="space-y-3">
                                <button onclick="limparVendasAntigas()" 
                                    class="w-full text-left p-3 bg-white rounded border hover:bg-gray-50">
                                    üóÇÔ∏è Limpar hist√≥rico de vendas antigas (>30 dias)
                                </button>
                                <button onclick="limparClientesSemDivida()" 
                                    class="w-full text-left p-3 bg-white rounded border hover:bg-gray-50">
                                    üë• Remover clientes sem d√≠vida e sem hist√≥rico
                                </button>
                                <button onclick="limparApenasHistoricoDividas()" 
                                    class="w-full text-left p-3 bg-yellow-100 text-yellow-700 rounded border border-yellow-300 hover:bg-yellow-200">
                                    üí∞ Zerar todas as d√≠vidas (manter clientes e produtos)
                                </button>
                                <button onclick="resetarSistema()" 
                                    class="w-full text-left p-3 bg-red-100 text-red-700 rounded border border-red-300 hover:bg-red-200">
                                    ‚ö†Ô∏è Resetar sistema completamente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer do Modal -->
            <div class="bg-gray-50 px-6 py-4 border-t flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    Configura√ß√µes salvas automaticamente
                </div>
                <div class="flex space-x-3">
                    <button onclick="restaurarPadroes()" 
                        class="px-4 py-2 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50">
                        üîÑ Restaurar Padr√µes
                    </button>
                    <button onclick="fecharConfiguracoes()" 
                        class="btn-primary px-6 py-2 rounded-lg text-white font-medium">
                        ‚úÖ Conclu√≠do
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Venda -->
    <div id="modal-editar-venda" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‚úèÔ∏è Editar Venda</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Cliente</label>
                    <input type="text" id="editar-venda-cliente" readonly
                        class="w-full p-3 border-2 rounded-lg bg-gray-100 text-gray-600">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Produto</label>
                    <input type="text" id="editar-venda-produto" readonly
                        class="w-full p-3 border-2 rounded-lg bg-gray-100 text-gray-600">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Quantidade</label>
                        <input type="number" id="editar-venda-quantidade" min="1" 
                            class="w-full p-3 border-2 rounded-lg input-focus"
                            oninput="calcularStatusEdicao()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Pre√ßo Unit√°rio</label>
                        <input type="text" id="editar-venda-preco-display" readonly
                            class="w-full p-3 border-2 rounded-lg bg-gray-100 text-gray-600">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Status</label>
                        <input type="text" id="editar-venda-status-display" readonly
                            class="w-full p-3 border-2 rounded-lg bg-gray-100 text-gray-600 font-medium">
                        <input type="hidden" id="editar-venda-status">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Valor Pago</label>
                        <input type="number" id="editar-venda-valor" step="0.01" 
                            class="w-full p-3 border-2 rounded-lg input-focus"
                            oninput="calcularStatusEdicao()">
                    </div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <div class="text-sm text-blue-800">
                        <div class="font-medium mb-1">üí° Dica de Edi√ß√£o:</div>
                        <div class="text-xs">
                            ‚Ä¢ <strong>Valor 0 ou vazio:</strong> Fiado<br>
                            ‚Ä¢ <strong>Valor = Total:</strong> Pago completo<br>
                            ‚Ä¢ <strong>Valor > Total:</strong> Pago + cr√©dito<br>
                            ‚Ä¢ <strong>Valor < Total:</strong> Pago parcial
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex space-x-3 mt-6">
                <button onclick="salvarEdicaoVenda()" class="btn-primary flex-1 py-2 rounded-lg text-white font-medium">
                    ‚úÖ Salvar Altera√ß√µes
                </button>
                <button onclick="fecharModalEditarVenda()" class="border-2 border-gray-300 flex-1 py-2 rounded-lg font-medium hover:bg-gray-50">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Valida√ß√£o -->
    <div id="modal-validacao" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-red-600">‚ö†Ô∏è Problemas Encontrados</h3>
                <button onclick="fecharModalValidacao()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Clientes n√£o encontrados -->
                <div id="clientes-nao-encontrados" class="hidden">
                    <h4 class="font-semibold mb-4 text-red-600">üë• Clientes N√£o Cadastrados</h4>
                    <div id="lista-clientes-nao-encontrados" class="space-y-3 mb-4"></div>
                    <p class="text-sm text-gray-600 mt-4">Para cada cliente, voc√™ pode cadastr√°-lo imediatamente ou adicionar √† lista de pendentes para cadastrar depois.</p>
                </div>

                <!-- Produtos n√£o encontrados -->
                <div id="produtos-nao-encontrados" class="hidden">
                    <h4 class="font-semibold mb-4 text-red-600">üõçÔ∏è Produtos N√£o Cadastrados</h4>
                    <div id="lista-produtos-nao-encontrados" class="space-y-3 mb-4"></div>
                    <p class="text-sm text-gray-600 mb-4">Verifique se os nomes est√£o corretos ou cadastre os produtos.</p>
                </div>
            </div>

            <div class="mt-6 pt-4 border-t flex space-x-3">
                <button onclick="processarVendasValidadas()" class="btn-primary flex-1 py-3 rounded-lg text-white font-medium">
                    ‚úÖ Processar Vendas V√°lidas
                </button>
                <button onclick="fecharModalValidacao()" class="border-2 border-gray-300 flex-1 py-3 rounded-lg font-medium hover:bg-gray-50">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
        let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
        let vendasDia = JSON.parse(localStorage.getItem('vendasDia')) || [];
        let pagamentosAvulsos = JSON.parse(localStorage.getItem('pagamentosAvulsos')) || [];
        let dividas = JSON.parse(localStorage.getItem('dividas')) || {};
        let historicoVendas = JSON.parse(localStorage.getItem('historicoVendas')) || [];
        let clientesPendentes = JSON.parse(localStorage.getItem('clientesPendentes')) || [];
        let vendaIndividualAtual = [];
        let vendasValidadasTemp = [];
        let produtoSelecionadoAtual = null;
        let produtoEditandoId = null;
        let clienteEditandoId = null;
        let vendaEditandoId = null;
        let produtoVendaEditando = null;
        
        // Controle de relat√≥rios
        let periodoRelatorioAtual = 'hoje';
        let dataInicialPersonalizada = null;
        let dataFinalPersonalizada = null;
        
        // Configura√ß√µes do sistema
        let configuracoes = JSON.parse(localStorage.getItem('configuracoes')) || {
            whatsapp: {
                mensagemPrincipal: '*ATUALIZA√á√ÉO DA CONTA* _{hora}_\ntava {dividaAnterior}\n\n{data}\n{produtos}\n{pagamentos}\n\n*TOTAL={dividaTotal}*',
                incluirHora: true,
                formatoData: 'dd/mm',
                mostrarDividaZero: true
            },
            visual: {
                tema: 'roxo-azul',
                animacoes: 'alta',
                efeitoDopamina: true,
                sonsFeedback: false,
                particulas: false,
                modoNetflix: false
            },
            sistema: {
                autoSave: 60,
                confirmacaoExclusao: 'sempre',
                limiteBusca: 8
            }
        };

        // Sistema de sons
        const sons = {
            sucesso: () => {
                if (!configuracoes.visual.sonsFeedback) return;
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                oscillator.frequency.setValueAtTime(800, audio.currentTime);
                oscillator.frequency.setValueAtTime(1000, audio.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.3);
                
                oscillator.start(audio.currentTime);
                oscillator.stop(audio.currentTime + 0.3);
            },
            erro: () => {
                if (!configuracoes.visual.sonsFeedback) return;
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                oscillator.frequency.setValueAtTime(400, audio.currentTime);
                oscillator.frequency.setValueAtTime(200, audio.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.4);
                
                oscillator.start(audio.currentTime);
                oscillator.stop(audio.currentTime + 0.4);
            },
            click: () => {
                if (!configuracoes.visual.sonsFeedback) return;
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                oscillator.frequency.setValueAtTime(600, audio.currentTime);
                
                gainNode.gain.setValueAtTime(0.1, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.1);
                
                oscillator.start(audio.currentTime);
                oscillator.stop(audio.currentTime + 0.1);
            }
        };

        // Aplicar tema
        function aplicarTema() {
            const body = document.body;
            
            // Remover TODAS as classes de tema anteriores
            body.classList.remove('tema-verde-azul', 'tema-laranja-rosa', 'tema-escuro', 'netflix-mode');
            
            // Remover classes Netflix de todos os elementos
            document.querySelectorAll('.netflix-card, .netflix-button, .netflix-reward-button, .netflix-input, .netflix-tab, .netflix-text, .netflix-text-muted, .netflix-text-bright, .netflix-divida-card, .netflix-reveal').forEach(el => {
                el.classList.remove('netflix-card', 'netflix-button', 'netflix-reward-button', 'netflix-input', 'netflix-tab', 'netflix-text', 'netflix-text-muted', 'netflix-text-bright', 'netflix-divida-card', 'netflix-reveal', 'deve', 'credito', 'em-dia');
            });
            
            // Aplicar novo tema
            if (configuracoes.visual.modoNetflix) {
                body.classList.add('netflix-mode');
                criarParticulasNetflix();
                setTimeout(() => aplicarAnimacoesNetflix(), 200);
            } else {
                body.classList.add('tema-' + configuracoes.visual.tema);
                removerParticulasNetflix();
                // For√ßar re-render para garantir que as cores voltem ao normal
                setTimeout(() => {
                    atualizarListas();
                }, 100);
            }
        }

        // Criar part√≠culas Netflix
        function criarParticulasNetflix() {
            if (!configuracoes.visual.particulas || !configuracoes.visual.modoNetflix) return;
            
            let container = document.getElementById('netflix-particles');
            if (!container) {
                container = document.createElement('div');
                container.id = 'netflix-particles';
                container.className = 'netflix-particles';
                document.body.appendChild(container);
            }
            
            // Criar 20 part√≠culas
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'netflix-particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 8 + 's';
                    particle.style.animationDuration = (8 + Math.random() * 4) + 's';
                    container.appendChild(particle);
                    
                    // Remover part√≠cula ap√≥s anima√ß√£o
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 12000);
                }, i * 400);
            }
        }

        // Remover part√≠culas Netflix
        function removerParticulasNetflix() {
            const container = document.getElementById('netflix-particles');
            if (container) {
                container.remove();
            }
        }

        // Sistema de recompensas estrat√©gicas
        function aplicarAnimacoesNetflix() {
            if (!configuracoes.visual.modoNetflix) return;
            
            // Aplicar classes Netflix aos elementos
            setTimeout(() => {
                document.querySelectorAll('.card-shadow').forEach((card, index) => {
                    card.classList.add('netflix-card', 'netflix-reveal');
                    card.style.animationDelay = (index * 0.1) + 's';
                });
                
                // Bot√µes normais - sem dopamina excessiva
                document.querySelectorAll('.btn-primary').forEach(btn => {
                    btn.classList.add('netflix-button');
                });
                
                // Bot√µes de RECOMPENSA - s√≥ os importantes
                document.querySelectorAll('button').forEach(btn => {
                    if (btn.textContent.includes('Finalizar Dia') || 
                        btn.textContent.includes('Processar Vendas') || 
                        btn.textContent.includes('Cadastrar Produto') || 
                        btn.textContent.includes('Cadastrar Cliente') ||
                        btn.textContent.includes('Finalizar Venda')) {
                        btn.classList.remove('netflix-button');
                        btn.classList.add('netflix-reward-button');
                    }
                });
                
                document.querySelectorAll('input, textarea, select').forEach(input => {
                    input.classList.add('netflix-input');
                });
                
                document.querySelectorAll('nav button').forEach(btn => {
                    btn.classList.add('netflix-tab');
                });
                
                document.querySelectorAll('.gradient-bg').forEach(header => {
                    header.classList.add('netflix-header');
                });
                
                // Aplicar classes de texto com melhor legibilidade
                document.querySelectorAll('h1, h2, h3, h4').forEach(heading => {
                    heading.classList.add('netflix-text-bright');
                });
                
                document.querySelectorAll('p, span, div').forEach(text => {
                    if (text.classList.contains('text-gray-500') || text.classList.contains('text-gray-600')) {
                        text.classList.add('netflix-text-muted');
                    } else if (text.textContent.trim()) {
                        text.classList.add('netflix-text');
                    }
                });
                
                // Aplicar classes espec√≠ficas aos cards de d√≠vida
                setTimeout(aplicarClassesDividaNetflix, 200);
            }, 100);
        }
        
        // Aplicar classes espec√≠ficas aos cards de d√≠vida
        function aplicarClassesDividaNetflix() {
            if (!configuracoes.visual.modoNetflix) return;
            
            document.querySelectorAll('#lista-dividas .group').forEach(card => {
                card.classList.add('netflix-divida-card');
                
                // Identificar tipo de d√≠vida pela cor do texto
                const valorElement = card.querySelector('.text-red-600, .text-blue-600, .text-green-600');
                if (valorElement) {
                    if (valorElement.classList.contains('text-red-600')) {
                        card.classList.add('deve');
                    } else if (valorElement.classList.contains('text-blue-600')) {
                        card.classList.add('credito');
                    } else if (valorElement.classList.contains('text-green-600')) {
                        card.classList.add('em-dia');
                    }
                }
            });
        }
        
        // Mostrar conquista dopamin√©rgica
        function mostrarConquista(mensagem) {
            if (!configuracoes.visual.modoNetflix) return;
            
            const achievement = document.createElement('div');
            achievement.className = 'netflix-achievement';
            achievement.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">üèÜ</div>
                <div>${mensagem}</div>
            `;
            
            document.body.appendChild(achievement);
            
            // Ativar part√≠culas temporariamente
            ativarParticulasConquista();
            
            setTimeout(() => {
                achievement.remove();
            }, 2000);
        }
        
        // Ativar part√≠culas s√≥ em momentos de conquista
        function ativarParticulasConquista() {
            if (!configuracoes.visual.modoNetflix || !configuracoes.visual.particulas) return;
            
            const container = document.getElementById('netflix-particles');
            if (container) {
                container.classList.add('active');
                
                // Criar burst de part√≠culas
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'netflix-particle';
                        particle.style.left = (Math.random() * 100) + '%';
                        particle.style.animationDelay = (Math.random() * 2) + 's';
                        container.appendChild(particle);
                        
                        setTimeout(() => {
                            if (particle.parentNode) {
                                particle.parentNode.removeChild(particle);
                            }
                        }, 6000);
                    }, i * 100);
                }
                
                // Desativar ap√≥s 3 segundos
                setTimeout(() => {
                    container.classList.remove('active');
                }, 3000);
            }
        }

        // Auto-save
        function iniciarAutoSave() {
            if (configuracoes.sistema.autoSave > 0) {
                setInterval(() => {
                    localStorage.setItem('produtos', JSON.stringify(produtos));
                    localStorage.setItem('clientes', JSON.stringify(clientes));
                    localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
                    localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
                    localStorage.setItem('dividas', JSON.stringify(dividas));
                    localStorage.setItem('historicoVendas', JSON.stringify(historicoVendas));
                    localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
                    localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
                }, configuracoes.sistema.autoSave * 1000);
            }
        }

        // T√©cnicas de produtividade profissional
        let atalhosTeclado = true;
        let modoFocoAtivo = false;
        let tempoSessao = 0;
        let intervaloProdutividade = null;

        // Sistema de atalhos de teclado para m√°xima produtividade
        function iniciarAtalhosTeclado() {
            document.addEventListener('keydown', function(e) {
                if (!atalhosTeclado) return;
                
                // Ctrl/Cmd + teclas para navega√ß√£o r√°pida
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            showTab('vendas');
                            break;
                        case '2':
                            e.preventDefault();
                            showTab('produtos');
                            break;
                        case '3':
                            e.preventDefault();
                            showTab('clientes');
                            break;
                        case '4':
                            e.preventDefault();
                            showTab('dividas');
                            break;
                        case '5':
                            e.preventDefault();
                            showTab('relatorios');
                            break;
                        case 'n':
                            e.preventDefault();
                            setInputMode('individual');
                            document.getElementById('cliente-individual').focus();
                            break;
                        case 'm':
                            e.preventDefault();
                            setInputMode('chat');
                            document.getElementById('chat-input').focus();
                            break;
                        case 's':
                            e.preventDefault();
                            if (document.getElementById('vendas-tab').classList.contains('hidden')) {
                                showTab('vendas');
                            }
                            processarVendasChat();
                            break;
                        case 'f':
                            e.preventDefault();
                            finalizarDia();
                            break;
                        case ',':
                            e.preventDefault();
                            abrirConfiguracoes();
                            break;
                    }
                }
                
                // ESC para fechar modais
                if (e.key === 'Escape') {
                    fecharTodosModais();
                }
                
                // Enter para a√ß√µes r√°pidas em contexto
                if (e.key === 'Enter' && e.shiftKey) {
                    e.preventDefault();
                    const tabAtiva = document.querySelector('.tab-content:not(.hidden)');
                    if (tabAtiva && tabAtiva.id === 'vendas-tab') {
                        const modoAtivo = document.getElementById('chat-mode').classList.contains('hidden') ? 'individual' : 'chat';
                        if (modoAtivo === 'chat') {
                            processarVendasChat();
                        } else {
                            finalizarVendaIndividual();
                        }
                    }
                }
            });
        }

        // Modo foco para m√°xima concentra√ß√£o
        function ativarModoFoco() {
            modoFocoAtivo = true;
            document.body.classList.add('modo-foco');
            
            // Mostrar indicador
            document.getElementById('indicador-modo-foco').classList.remove('hidden');
            
            // Ir para aba de vendas se n√£o estiver nela
            if (document.getElementById('vendas-tab').classList.contains('hidden')) {
                showTab('vendas');
            }
            
            // Ocultar elementos de distra√ß√£o
            document.querySelectorAll('.card-shadow').forEach(card => {
                if (!card.closest('#vendas-tab')) {
                    card.style.opacity = '0.3';
                }
            });
            
            // Destacar √°rea de trabalho principal
            const vendasTab = document.getElementById('vendas-tab');
            if (vendasTab) {
                vendasTab.style.boxShadow = '0 0 30px rgba(79, 70, 229, 0.3)';
                vendasTab.style.border = '2px solid rgba(79, 70, 229, 0.5)';
                vendasTab.style.borderRadius = '12px';
            }
            
            // Focar no campo de entrada ativo
            setTimeout(() => {
                const modoAtivo = document.getElementById('chat-mode').classList.contains('hidden') ? 'individual' : 'chat';
                if (modoAtivo === 'chat') {
                    document.getElementById('chat-input').focus();
                } else {
                    document.getElementById('cliente-individual').focus();
                }
            }, 300);
            
            mostrarSucesso('üéØ Modo Foco ativado! Concentre-se nas vendas.');
            
            // Auto-desativar ap√≥s 25 minutos (t√©cnica Pomodoro)
            setTimeout(() => {
                if (modoFocoAtivo) {
                    desativarModoFoco();
                    mostrarAviso('‚è∞ Sess√£o de foco conclu√≠da! Fa√ßa uma pausa de 5 minutos.');
                }
            }, 25 * 60 * 1000);
        }

        function desativarModoFoco() {
            modoFocoAtivo = false;
            document.body.classList.remove('modo-foco');
            
            // Ocultar indicador
            document.getElementById('indicador-modo-foco').classList.add('hidden');
            
            // Restaurar opacidade
            document.querySelectorAll('.card-shadow').forEach(card => {
                card.style.opacity = '1';
            });
            
            // Remover destaque
            const vendasTab = document.getElementById('vendas-tab');
            if (vendasTab) {
                vendasTab.style.boxShadow = '';
                vendasTab.style.border = '';
                vendasTab.style.borderRadius = '';
            }
            
            mostrarSucesso('üåü Modo Foco desativado. √ìtimo trabalho!');
        }

        // Sistema de m√©tricas de produtividade
        function iniciarMetricasProdutividade() {
            intervaloProdutividade = setInterval(() => {
                tempoSessao++;
                
                // A cada 30 minutos, mostrar estat√≠sticas de produtividade
                if (tempoSessao % 1800 === 0) {
                    mostrarEstatisticasProdutividade();
                }
                
                // Lembretes inteligentes
                if (tempoSessao % 900 === 0 && vendasDia.length === 0) {
                    mostrarAviso('üí° Que tal registrar algumas vendas? O sistema est√° pronto!');
                }
            }, 1000);
        }

        function mostrarEstatisticasProdutividade() {
            const vendasUltimos30min = vendasDia.filter(v => {
                const agora = new Date();
                const vendaData = new Date(v.data);
                return (agora - vendaData) <= 30 * 60 * 1000;
            }).length;
            
            const produtividade = vendasUltimos30min > 5 ? 'Alta' : vendasUltimos30min > 2 ? 'M√©dia' : 'Baixa';
            const emoji = vendasUltimos30min > 5 ? 'üöÄ' : vendasUltimos30min > 2 ? '‚ö°' : 'üêå';
            
            mostrarNotificacao(`${emoji} Produtividade ${produtividade}: ${vendasUltimos30min} vendas nos √∫ltimos 30min`, 'info', 5000);
        }

        // Auto-completar inteligente
        function configurarAutoComplete() {
            // Auto-completar para campo de cliente
            const clienteInput = document.getElementById('cliente-individual');
            if (clienteInput) {
                clienteInput.addEventListener('input', function(e) {
                    const valor = e.target.value.toLowerCase();
                    if (valor.length >= 2) {
                        const clienteEncontrado = clientes.find(c => 
                            c.nome.toLowerCase().startsWith(valor) ||
                            c.tags.some(tag => tag.toLowerCase().startsWith(valor))
                        );
                        
                        if (clienteEncontrado && clienteEncontrado.nome.toLowerCase() !== valor) {
                            // Sugerir auto-completar
                            const sugestao = clienteEncontrado.nome;
                            e.target.setAttribute('data-sugestao', sugestao);
                            
                            // Mostrar sugest√£o visual
                            let sugestaoElement = document.getElementById('sugestao-visual');
                            if (!sugestaoElement) {
                                sugestaoElement = document.createElement('div');
                                sugestaoElement.id = 'sugestao-visual';
                                sugestaoElement.className = 'absolute top-full left-0 right-0 bg-blue-50 border border-blue-200 rounded-b-lg px-3 py-2 text-sm text-blue-700 z-10';
                                e.target.parentNode.style.position = 'relative';
                                e.target.parentNode.appendChild(sugestaoElement);
                            }
                            
                            sugestaoElement.innerHTML = `üí° Pressione <kbd class="bg-blue-200 px-1 rounded">Tab</kbd> para completar: <strong>${sugestao}</strong>`;
                            sugestaoElement.style.display = 'block';
                        }
                    }
                });
                
                clienteInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab' && e.target.getAttribute('data-sugestao')) {
                        e.preventDefault();
                        e.target.value = e.target.getAttribute('data-sugestao');
                        e.target.removeAttribute('data-sugestao');
                        
                        const sugestaoElement = document.getElementById('sugestao-visual');
                        if (sugestaoElement) {
                            sugestaoElement.style.display = 'none';
                        }
                        
                        // Focar pr√≥ximo campo
                        document.getElementById('produto-busca-individual').focus();
                    }
                });
            }
        }

        // Fechar todos os modais
        function fecharTodosModais() {
            const modais = [
                'modal-cliente', 'modal-perfil', 'modal-editar-produto', 
                'modal-editar-cliente', 'modal-configuracoes', 'modal-editar-venda', 
                'modal-validacao'
            ];
            
            modais.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            });
        }

        // Adicionar CSS para modo foco
        const estiloModoFoco = document.createElement('style');
        estiloModoFoco.textContent = `
            .modo-foco {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            }
            
            .modo-foco .gradient-bg {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%) !important;
                box-shadow: 0 4px 20px rgba(79, 70, 229, 0.3);
            }
            
            .modo-foco nav {
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px);
            }
            
            kbd {
                background: #e2e8f0;
                border: 1px solid #cbd5e0;
                border-radius: 3px;
                padding: 2px 4px;
                font-size: 0.75rem;
                font-family: monospace;
            }
        `;
        document.head.appendChild(estiloModoFoco);

        // Sistema de filtros de relat√≥rio
        function filtrarRelatorio(periodo) {
            periodoRelatorioAtual = periodo;
            
            // Atualizar bot√µes
            document.querySelectorAll('[id^="filtro-"]').forEach(btn => {
                btn.className = btn.className.replace('filtro-periodo-ativo', 'filtro-periodo-inativo');
            });
            document.getElementById('filtro-' + periodo).className = 
                document.getElementById('filtro-' + periodo).className.replace('filtro-periodo-inativo', 'filtro-periodo-ativo');
            
            // Mostrar/ocultar seletor personalizado
            const periodoPersonalizado = document.getElementById('periodo-personalizado');
            if (periodo === 'personalizado') {
                periodoPersonalizado.classList.remove('hidden');
                // Configurar datas padr√£o
                const hoje = new Date();
                const umaSemanaAtras = new Date(hoje);
                umaSemanaAtras.setDate(hoje.getDate() - 7);
                
                document.getElementById('data-inicial').value = umaSemanaAtras.toISOString().split('T')[0];
                document.getElementById('data-final').value = hoje.toISOString().split('T')[0];
                
                // Adicionar listeners para mudan√ßa de data
                document.getElementById('data-inicial').addEventListener('change', aplicarFiltroPersonalizado);
                document.getElementById('data-final').addEventListener('change', aplicarFiltroPersonalizado);
            } else {
                periodoPersonalizado.classList.add('hidden');
            }
            
            // Atualizar info do per√≠odo
            const infoPeriodo = {
                'hoje': 'Hoje',
                'ontem': 'Ontem',
                '7dias': '√öltimos 7 dias',
                '15dias': '√öltimas 2 semanas',
                '30dias': '√öltimo m√™s',
                'personalizado': 'Per√≠odo personalizado'
            };
            
            document.getElementById('periodo-selecionado-info').textContent = infoPeriodo[periodo];
            
            // Aplicar filtro
            if (periodo !== 'personalizado') {
                aplicarFiltroRelatorio();
            }
        }

        function aplicarFiltroPersonalizado() {
            const dataInicial = document.getElementById('data-inicial').value;
            const dataFinal = document.getElementById('data-final').value;
            
            if (dataInicial && dataFinal) {
                dataInicialPersonalizada = new Date(dataInicial);
                dataFinalPersonalizada = new Date(dataFinal);
                dataFinalPersonalizada.setHours(23, 59, 59, 999); // Incluir o dia todo
                
                aplicarFiltroRelatorio();
                
                // Atualizar info
                const dataInicialFormatada = dataInicialPersonalizada.toLocaleDateString('pt-BR');
                const dataFinalFormatada = new Date(dataFinal).toLocaleDateString('pt-BR');
                document.getElementById('periodo-selecionado-info').textContent = 
                    `${dataInicialFormatada} at√© ${dataFinalFormatada}`;
            }
        }

        function aplicarFiltroRelatorio() {
            // Obter dados filtrados
            const dadosFiltrados = obterDadosFiltrados();
            
            // Atualizar relat√≥rios com dados filtrados
            atualizarRelatoriosComDados(dadosFiltrados);
        }

        function obterDadosFiltrados() {
            let dataInicio, dataFim;
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            switch (periodoRelatorioAtual) {
                case 'hoje':
                    dataInicio = new Date(hoje);
                    dataFim = new Date(hoje);
                    dataFim.setHours(23, 59, 59, 999);
                    break;
                    
                case 'ontem':
                    dataInicio = new Date(hoje);
                    dataInicio.setDate(hoje.getDate() - 1);
                    dataFim = new Date(dataInicio);
                    dataFim.setHours(23, 59, 59, 999);
                    break;
                    
                case '7dias':
                    dataInicio = new Date(hoje);
                    dataInicio.setDate(hoje.getDate() - 6);
                    dataFim = new Date(hoje);
                    dataFim.setHours(23, 59, 59, 999);
                    break;
                    
                case '15dias':
                    dataInicio = new Date(hoje);
                    dataInicio.setDate(hoje.getDate() - 14);
                    dataFim = new Date(hoje);
                    dataFim.setHours(23, 59, 59, 999);
                    break;
                    
                case '30dias':
                    dataInicio = new Date(hoje);
                    dataInicio.setDate(hoje.getDate() - 29);
                    dataFim = new Date(hoje);
                    dataFim.setHours(23, 59, 59, 999);
                    break;
                    
                case 'personalizado':
                    dataInicio = dataInicialPersonalizada;
                    dataFim = dataFinalPersonalizada;
                    break;
                    
                default:
                    dataInicio = new Date(hoje);
                    dataFim = new Date(hoje);
                    dataFim.setHours(23, 59, 59, 999);
            }
            
            // Filtrar vendas do dia (se for hoje) ou hist√≥rico
            let vendasFiltradas = [];
            let pagamentosFiltrados = [];
            
            if (periodoRelatorioAtual === 'hoje') {
                vendasFiltradas = vendasDia;
                pagamentosFiltrados = pagamentosAvulsos;
            } else {
                // Buscar no hist√≥rico
                const historicoFiltrado = historicoVendas.filter(h => {
                    const dataHistorico = new Date(h.data);
                    return dataHistorico >= dataInicio && dataHistorico <= dataFim;
                });
                
                // Converter hist√≥rico para formato de vendas
                historicoFiltrado.forEach(h => {
                    h.vendas.forEach(v => {
                        vendasFiltradas.push({
                            ...v,
                            cliente: h.cliente,
                            data: h.data
                        });
                    });
                    
                    if (h.pagamentos > 0) {
                        pagamentosFiltrados.push({
                            cliente: h.cliente,
                            valor: h.pagamentos,
                            data: h.data
                        });
                    }
                });
            }
            
            return {
                vendas: vendasFiltradas,
                pagamentos: pagamentosFiltrados,
                dataInicio,
                dataFim
            };
        }

        function atualizarRelatoriosComDados(dados) {
            const { vendas, pagamentos } = dados;
            
            // Calcular m√©tricas
            let valorTotalVendido = 0;
            let recebidoVista = 0;
            let vendidoFiado = 0;
            let pagamentosVista = 0;
            let pagamentosParciais = 0;
            let vendasFiadas = 0;
            
            vendas.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                valorTotalVendido += totalVenda;
                
                if (venda.status === 'pago') {
                    recebidoVista += totalVenda;
                    pagamentosVista++;
                } else if (venda.status === 'pago-valor') {
                    const valorPagoVenda = venda.valorPago || 0;
                    recebidoVista += valorPagoVenda;
                    
                    const restante = totalVenda - valorPagoVenda;
                    if (restante > 0) {
                        vendidoFiado += restante;
                        pagamentosParciais++;
                    } else {
                        pagamentosVista++;
                    }
                } else {
                    vendidoFiado += totalVenda;
                    vendasFiadas++;
                }
            });
            
            // Somar pagamentos avulsos
            const totalPagamentosAvulsos = pagamentos.reduce((sum, p) => sum + (p.valor || 0), 0);
            recebidoVista += totalPagamentosAvulsos;
            
            // Atualizar elementos
            const elementos = {
                'faturamento-hoje': `R$ ${valorTotalVendido.toFixed(2)}`,
                'recebido-vista-relatorio': `R$ ${recebidoVista.toFixed(2)}`,
                'vendido-fiado-relatorio': `R$ ${vendidoFiado.toFixed(2)}`,
                'total-vendas-relatorio': vendas.length.toString()
            };
            
            Object.entries(elementos).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor;
            });
            
            // Atualizar an√°lise de pagamentos
            const elementosPagamento = {
                'pagamentos-vista-count': pagamentosVista,
                'pagamentos-parciais-count': pagamentosParciais,
                'vendas-fiadas-count': vendasFiadas,
                'pagamentos-avulsos-count': pagamentos.length
            };
            
            Object.entries(elementosPagamento).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor.toString();
            });
            
            // M√©tricas de efici√™ncia
            const ticketMedio = vendas.length > 0 ? valorTotalVendido / vendas.length : 0;
            const taxaPagamento = vendas.length > 0 ? (pagamentosVista / vendas.length) * 100 : 0;
            const clientesAtendidos = new Set(vendas.map(v => v.cliente)).size;
            
            const elementosEficiencia = {
                'ticket-medio': `R$ ${ticketMedio.toFixed(2)}`,
                'taxa-pagamento': `${taxaPagamento.toFixed(1)}%`,
                'clientes-atendidos': clientesAtendidos.toString()
            };
            
            Object.entries(elementosEficiencia).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor;
            });
            
            // Atualizar listas detalhadas
            atualizarTopProdutosComDados(vendas);
            atualizarClientesMaisAtivosComDados(vendas);
            atualizarVendasPorCategoriaComDados(vendas);
            
            // Atualizar timestamp
            const agora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            const elementoTimestamp = document.getElementById('relatorio-ultima-atualizacao');
            if (elementoTimestamp) {
                elementoTimestamp.textContent = agora;
            }
        }

        // Vers√µes espec√≠ficas para dados filtrados
        function atualizarTopProdutosComDados(vendas) {
            const produtosMaisVendidos = {};
            const faturamentoPorProduto = {};
            
            vendas.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                produtosMaisVendidos[venda.produto] = (produtosMaisVendidos[venda.produto] || 0) + venda.quantidade;
                faturamentoPorProduto[venda.produto] = (faturamentoPorProduto[venda.produto] || 0) + totalVenda;
            });

            const produtosOrdenados = Object.entries(produtosMaisVendidos)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const lista = document.getElementById('produtos-mais-vendidos-relatorio');
            if (!lista) return;

            if (produtosOrdenados.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üì¶</div>
                        <p>Nenhuma venda no per√≠odo selecionado</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = produtosOrdenados.map(([produto, quantidade], index) => {
                const faturamento = faturamentoPorProduto[produto] || 0;
                const posicao = index + 1;
                const medalha = posicao === 1 ? 'ü•á' : posicao === 2 ? 'ü•à' : posicao === 3 ? 'ü•â' : `${posicao}¬∫`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-100">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${medalha}</span>
                            <div>
                                <div class="font-bold text-gray-800">${produto}</div>
                                <div class="text-sm text-gray-600">${quantidade} unidades vendidas</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-purple-600">R$ ${faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">faturamento</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function atualizarClientesMaisAtivosComDados(vendas) {
            const clientesAtivos = {};
            const faturamentoPorCliente = {};
            
            vendas.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                clientesAtivos[venda.cliente] = (clientesAtivos[venda.cliente] || 0) + 1;
                faturamentoPorCliente[venda.cliente] = (faturamentoPorCliente[venda.cliente] || 0) + totalVenda;
            });

            const clientesOrdenados = Object.entries(clientesAtivos)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const lista = document.getElementById('clientes-mais-ativos');
            if (!lista) return;

            if (clientesOrdenados.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üë§</div>
                        <p>Nenhuma venda no per√≠odo selecionado</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = clientesOrdenados.map(([cliente, compras], index) => {
                const faturamento = faturamentoPorCliente[cliente] || 0;
                const posicao = index + 1;
                const medalha = posicao === 1 ? 'üëë' : posicao === 2 ? '‚≠ê' : posicao === 3 ? 'üåü' : `${posicao}¬∫`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg border border-green-100 cursor-pointer hover:shadow-md transition-all" onclick="mostrarPerfil('${cliente}')">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${medalha}</span>
                            <div>
                                <div class="font-bold text-gray-800">${cliente}</div>
                                <div class="text-sm text-gray-600">${compras} compras no per√≠odo</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">R$ ${faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">total gasto</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function atualizarVendasPorCategoriaComDados(vendas) {
            const vendasPorCategoria = {};
            
            vendas.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const categoria = produto ? produto.categoria : 'outros';
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                if (!vendasPorCategoria[categoria]) {
                    vendasPorCategoria[categoria] = { quantidade: 0, faturamento: 0 };
                }
                
                vendasPorCategoria[categoria].quantidade += venda.quantidade;
                vendasPorCategoria[categoria].faturamento += totalVenda;
            });

            const categoriasOrdenadas = Object.entries(vendasPorCategoria)
                .sort(([,a], [,b]) => b.faturamento - a.faturamento);

            const lista = document.getElementById('vendas-por-categoria');
            if (!lista) return;

            if (categoriasOrdenadas.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-3xl mb-2">üìà</div>
                        <p class="text-sm">Nenhuma venda no per√≠odo selecionado</p>
                    </div>
                `;
                return;
            }

            const totalFaturamento = categoriasOrdenadas.reduce((sum, [, dados]) => sum + dados.faturamento, 0);

            lista.innerHTML = categoriasOrdenadas.map(([categoria, dados]) => {
                const percentual = totalFaturamento > 0 ? (dados.faturamento / totalFaturamento) * 100 : 0;
                const iconeCategoria = {
                    'doces': 'üç≠',
                    'salgados': 'ü•ü',
                    'chiclete': 'üç¨',
                    'bebidas': 'ü•§',
                    'outros': 'üì¶'
                };
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-100">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${iconeCategoria[categoria] || 'üì¶'}</span>
                            <div>
                                <div class="font-medium text-gray-800 capitalize">${categoria}</div>
                                <div class="text-xs text-gray-600">${dados.quantidade} itens</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-purple-600">R$ ${dados.faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">${percentual.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            aplicarTema();
            atualizarListas();
            atualizarResumos();
            setInputMode('chat');
            iniciarAutoSave();
            iniciarAtalhosTeclado();
            iniciarMetricasProdutividade();
            configurarAutoComplete();
            
            // Inicializar relat√≥rios com per√≠odo padr√£o
            setTimeout(() => {
                filtrarRelatorio('hoje');
            }, 500);
            
            // Garantir que as sugest√µes de produtos sejam atualizadas
            setTimeout(() => {
                atualizarSugestoesProdutos();
            }, 100);
            
            // Recriar part√≠culas Netflix periodicamente se ativo
            if (configuracoes.visual.modoNetflix && configuracoes.visual.particulas) {
                setInterval(criarParticulasNetflix, 10000);
            }
            
            // Mostrar dicas de produtividade na primeira vez
            if (!localStorage.getItem('dicasProdutividadeMostradas')) {
                setTimeout(() => {
                    mostrarDicasProdutividade();
                    localStorage.setItem('dicasProdutividadeMostradas', 'true');
                }, 2000);
            }
        });

        // Copiar prompt para IA
        function copiarPromptIA() {
            const produtosDisponiveis = produtos.map(p => {
                const sabores = p.sabores.length > 0 ? ` (sabores: ${p.sabores.join(', ')})` : '';
                return `${p.nome}${sabores}`;
            }).join('\n');
            
            const clientesDisponiveis = clientes.map(c => c.nome).join(', ');
            
            const prompt = `Voc√™ √© um assistente especializado em formatar vendas para um sistema. Formate o texto que eu enviar seguindo EXATAMENTE este padr√£o:

FORMATO OBRIGAT√ìRIO: Nome Quantidade Produto [PAGO] [Valor]

PRODUTOS DISPON√çVEIS:
${produtosDisponiveis || 'Nenhum produto cadastrado ainda'}

CLIENTES CADASTRADOS:
${clientesDisponiveis || 'Nenhum cliente cadastrado ainda'}

REGRAS IMPORTANTES:
1. Use EXATAMENTE os nomes dos produtos listados acima
2. Para produtos com sabores, use: "produto sabor" (ex: "trufa chocolate")
3. Se n√£o especificar PAGO, ser√° considerado FIADO
4. PAGO sem valor = cliente pagou o valor total do produto
5. PAGO com valor = cliente pagou valor espec√≠fico
6. Uma linha por venda
7. Mantenha os nomes dos clientes como est√£o no texto original

EXEMPLOS:
Jo√£o 2 trufa chocolate
Maria 1 brigadeiro PAGO
Pedro 3 coxinha PAGO 10.50

Agora formate o texto que eu enviar:`;

            navigator.clipboard.writeText(prompt).then(() => {
                mostrarSucesso('ü§ñ Prompt copiado! Cole em qualquer IA (ChatGPT, Claude, etc.) e depois envie seu texto de vendas.');
            }).catch(() => {
                // Fallback para navegadores mais antigos
                const textArea = document.createElement('textarea');
                textArea.value = prompt;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                mostrarSucesso('ü§ñ Prompt copiado! Cole em qualquer IA e envie seu texto de vendas.');
            });
        }

        // Mostrar dicas de produtividade
        function mostrarDicasProdutividade() {
            const dicas = `
                üöÄ DICAS DE PRODUTIVIDADE ULTRA PROFISSIONAL:
                
                ‚å®Ô∏è ATALHOS DE TECLADO:
                ‚Ä¢ Ctrl+1-5: Navegar entre abas
                ‚Ä¢ Ctrl+N: Nova venda individual
                ‚Ä¢ Ctrl+M: Modo chat
                ‚Ä¢ Ctrl+S: Processar vendas
                ‚Ä¢ Ctrl+F: Finalizar dia
                ‚Ä¢ Shift+Enter: A√ß√£o r√°pida
                ‚Ä¢ ESC: Fechar modais
                
                üéØ MODO FOCO:
                ‚Ä¢ Clique no bot√£o "Modo Foco" para concentra√ß√£o m√°xima
                ‚Ä¢ Sess√µes de 25 minutos (t√©cnica Pomodoro)
                ‚Ä¢ Destaque autom√°tico da √°rea de trabalho
                
                üí° AUTO-COMPLETAR:
                ‚Ä¢ Digite 2+ letras e pressione Tab para completar
                ‚Ä¢ Sugest√µes inteligentes baseadas no hist√≥rico
                
                üìä M√âTRICAS EM TEMPO REAL:
                ‚Ä¢ Relat√≥rios executivos sincronizados
                ‚Ä¢ An√°lise de produtividade a cada 30min
                ‚Ä¢ Lembretes inteligentes
            `;
            
            alert(dicas);
        }

        // Navega√ß√£o entre abas
        function showTab(tabName) {
            sons.click();
            
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('hover:bg-gray-100');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Ativar bot√£o selecionado
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.add('tab-active');
            activeBtn.classList.remove('hover:bg-gray-100');
            
            // Se for a aba de vendas, atualizar sugest√µes de produtos
            if (tabName === 'vendas') {
                setTimeout(() => {
                    atualizarSugestoesProdutos();
                }, 100);
            }
        }

        // Modo de entrada de vendas
        function setInputMode(mode) {
            sons.click();
            
            document.querySelectorAll('.input-mode').forEach(el => el.classList.add('hidden'));
            document.getElementById(mode + '-mode').classList.remove('hidden');
            
            // Atualizar bot√µes
            document.getElementById('mode-chat').classList.toggle('btn-primary', mode === 'chat');
            document.getElementById('mode-chat').classList.toggle('border-2', mode !== 'chat');
            document.getElementById('mode-chat').classList.toggle('border-gray-300', mode !== 'chat');
            document.getElementById('mode-chat').classList.toggle('text-white', mode === 'chat');
            
            document.getElementById('mode-individual').classList.toggle('btn-primary', mode === 'individual');
            document.getElementById('mode-individual').classList.toggle('border-2', mode !== 'individual');
            document.getElementById('mode-individual').classList.toggle('border-gray-300', mode !== 'individual');
            document.getElementById('mode-individual').classList.toggle('text-white', mode === 'individual');
            
            // Se mudou para modo individual, atualizar sugest√µes de produtos
            if (mode === 'individual') {
                setTimeout(() => {
                    atualizarSugestoesProdutos();
                }, 100);
            }
        }

        // Cadastrar produto
        function cadastrarProduto() {
            const nome = document.getElementById('produto-nome').value.trim();
            const preco = parseFloat(document.getElementById('produto-preco').value);
            const categoria = document.getElementById('produto-categoria').value;
            const sabores = document.getElementById('produto-sabores').value.split(',').map(s => s.trim()).filter(s => s);
            const tags = document.getElementById('produto-tags').value.split(',').map(t => t.trim()).filter(t => t);

            // Valida√ß√µes
            if (!nome) {
                mostrarErro('Por favor, informe o nome do produto');
                document.getElementById('produto-nome').focus();
                return;
            }

            if (!preco || preco <= 0) {
                mostrarErro('Por favor, informe um pre√ßo v√°lido');
                document.getElementById('produto-preco').focus();
                return;
            }

            // Verificar se produto j√° existe
            const produtoExistente = produtos.find(p => p.nome.toLowerCase() === nome.toLowerCase());
            if (produtoExistente) {
                mostrarErro('J√° existe um produto com este nome');
                document.getElementById('produto-nome').focus();
                return;
            }

            const loading = mostrarLoading('Cadastrando produto...');

            setTimeout(() => {
                const produto = {
                    id: Date.now(),
                    nome,
                    preco,
                    categoria,
                    sabores,
                    tags: [...tags, nome.toLowerCase()]
                };

                produtos.push(produto);
                localStorage.setItem('produtos', JSON.stringify(produtos));
                
                // Limpar formul√°rio
                document.getElementById('produto-nome').value = '';
                document.getElementById('produto-preco').value = '';
                document.getElementById('produto-sabores').value = '';
                document.getElementById('produto-tags').value = '';
                
                removerLoading();
                atualizarListas();
                mostrarSucesso(`Produto "${nome}" cadastrado com sucesso!`);
                
                // RECOMPENSA DOPAMIN√âRGICA - Produto cadastrado
                mostrarConquista(`PRODUTO CADASTRADO!\n"${nome}" adicionado ao sistema`);
            }, 300);
        }

        // Cadastrar cliente
        function cadastrarCliente() {
            const nome = document.getElementById('cliente-nome').value.trim();
            const celular = document.getElementById('cliente-celular').value.trim();
            const tags = document.getElementById('cliente-tags').value.split(',').map(t => t.trim()).filter(t => t);

            // Valida√ß√µes
            if (!nome) {
                mostrarErro('Por favor, informe o nome do cliente');
                document.getElementById('cliente-nome').focus();
                return;
            }

            if (!celular) {
                mostrarErro('Por favor, informe o celular do cliente');
                document.getElementById('cliente-celular').focus();
                return;
            }

            // Validar formato do celular (b√°sico)
            const celularLimpo = celular.replace(/\D/g, '');
            if (celularLimpo.length < 10 || celularLimpo.length > 11) {
                mostrarErro('Por favor, informe um n√∫mero de celular v√°lido');
                document.getElementById('cliente-celular').focus();
                return;
            }

            // Verificar se cliente j√° existe
            const clienteExistente = clientes.find(c => 
                c.nome.toLowerCase() === nome.toLowerCase() || 
                c.celular.replace(/\D/g, '') === celularLimpo
            );
            
            if (clienteExistente) {
                mostrarErro('J√° existe um cliente com este nome ou celular');
                return;
            }

            const loading = mostrarLoading('Cadastrando cliente...');

            setTimeout(() => {
                const cliente = {
                    id: Date.now(),
                    nome,
                    celular,
                    tags: [...tags, nome.toLowerCase()]
                };

                clientes.push(cliente);
                localStorage.setItem('clientes', JSON.stringify(clientes));
                
                // Limpar formul√°rio
                document.getElementById('cliente-nome').value = '';
                document.getElementById('cliente-celular').value = '';
                document.getElementById('cliente-tags').value = '';
                
                removerLoading();
                atualizarListas();
                mostrarSucesso(`Cliente "${nome}" cadastrado com sucesso!`);
                
                // RECOMPENSA DOPAMIN√âRGICA - Cliente cadastrado
                mostrarConquista(`CLIENTE CADASTRADO!\n"${nome}" adicionado ao sistema`);
            }, 300);
        }

        // Processar vendas do chat
        function processarVendasChat() {
            const texto = document.getElementById('chat-input').value.trim();
            if (!texto) {
                mostrarAviso('Digite as vendas antes de processar');
                return;
            }

            const loading = mostrarLoading('Processando vendas...');

            // Pequeno delay para mostrar o loading
            setTimeout(() => {
                const linhas = texto.split('\n').filter(linha => linha.trim());
                let vendasProcessadas = 0;
                let clientesNaoEncontrados = [];
                let produtosNaoEncontrados = [];
                let linhasInvalidas = [];

                // Primeira passagem: validar tudo
                const vendasParaProcessar = [];
                
                linhas.forEach((linha, index) => {
                    const venda = parseLinhaVenda(linha);
                    if (!venda) {
                        linhasInvalidas.push({
                            linha: index + 1,
                            texto: linha,
                            erro: 'Formato inv√°lido'
                        });
                        return;
                    }

                    const cliente = encontrarCliente(venda.cliente);
                    const resultadoProduto = encontrarProdutoComSabor(venda.produto);
                    
                    if (!cliente && !clientesNaoEncontrados.includes(venda.cliente)) {
                        clientesNaoEncontrados.push(venda.cliente);
                    }
                    
                    if (!resultadoProduto.produto && !produtosNaoEncontrados.some(p => p.nome === venda.produto)) {
                        produtosNaoEncontrados.push({
                            nome: venda.produto,
                            linha: index + 1,
                            cliente: venda.cliente
                        });
                    }
                    
                    if (cliente && resultadoProduto.produto) {
                        // Atualizar o nome do produto para incluir sabor se identificado
                        const nomeCompleto = resultadoProduto.sabor ? 
                            `${resultadoProduto.produto.nome} (${resultadoProduto.sabor})` : 
                            resultadoProduto.produto.nome;
                        
                        vendasParaProcessar.push({
                            ...venda,
                            produto: nomeCompleto,
                            produtoOriginal: resultadoProduto.produto.nome,
                            sabor: resultadoProduto.sabor
                        });
                    }
                });

                removerLoading();

                // Mostrar erros de formato se houver
                if (linhasInvalidas.length > 0) {
                    mostrarErro(`${linhasInvalidas.length} linha(s) com formato inv√°lido encontrada(s)`);
                }

                // Se houver problemas, mostrar modal de valida√ß√£o
                if (clientesNaoEncontrados.length > 0 || produtosNaoEncontrados.length > 0) {
                    mostrarModalValidacao(clientesNaoEncontrados, produtosNaoEncontrados, vendasParaProcessar);
                    return;
                }

                // Se tudo estiver ok, processar vendas
                if (vendasParaProcessar.length > 0) {
                    vendasParaProcessar.forEach(venda => {
                        adicionarVenda(venda);
                        vendasProcessadas++;
                    });

                    document.getElementById('chat-input').value = '';
                    atualizarListas();
                    mostrarSucesso(`${vendasProcessadas} vendas processadas com sucesso!`);
                    
                    // RECOMPENSA DOPAMIN√âRGICA - Vendas processadas
                    mostrarConquista(`VENDAS PROCESSADAS!\n${vendasProcessadas} vendas registradas`);
                } else if (linhasInvalidas.length === 0) {
                    mostrarAviso('Nenhuma venda v√°lida encontrada');
                }
            }, 500);
        }

        // Parse de linha de venda
        function parseLinhaVenda(linha) {
            // Formato: "Nome quantidade produto [PAGO] [valor]"
            const regex = /^(.+?)\s+(\d+)\s+(.+?)(?:\s+(PAGO)(?:\s+([\d,\.]+))?)?$/i;
            const match = linha.match(regex);
            
            if (!match) return null;

            const [, cliente, quantidade, produto, pagoTexto, valorTexto] = match;
            
            let status = 'fiado';
            let valorPago = 0;
            
            if (pagoTexto && pagoTexto.toLowerCase() === 'pago') {
                if (valorTexto) {
                    // PAGO com valor espec√≠fico
                    status = 'pago-valor';
                    valorPago = parseFloat(valorTexto.replace(',', '.'));
                } else {
                    // PAGO sem valor = pagou tudo
                    status = 'pago';
                    valorPago = 0; // Ser√° calculado depois com base no pre√ßo do produto
                }
            }
            
            return {
                cliente: cliente.trim(),
                produto: produto.trim(),
                quantidade: parseInt(quantidade),
                status: status,
                valorPago: valorPago
            };
        }

        // Mostrar modal de valida√ß√£o
        function mostrarModalValidacao(clientesNaoEncontrados, produtosNaoEncontrados, vendasValidas) {
            vendasValidadasTemp = vendasValidas;
            
            const modal = document.getElementById('modal-validacao');
            
            // Mostrar clientes n√£o encontrados
            if (clientesNaoEncontrados.length > 0) {
                document.getElementById('clientes-nao-encontrados').classList.remove('hidden');
                const listaClientes = document.getElementById('lista-clientes-nao-encontrados');
                listaClientes.innerHTML = clientesNaoEncontrados.map((cliente, index) => `
                    <div class="bg-white p-4 rounded-lg border border-red-200">
                        <div class="flex justify-between items-start mb-3">
                            <span class="font-medium text-red-700">${cliente}</span>
                        </div>
                        <div class="space-y-2">
                            <input type="tel" id="cliente-celular-${index}" placeholder="Celular do cliente" 
                                class="w-full p-2 border-2 rounded-lg input-focus text-sm">
                            <input type="text" id="cliente-tags-${index}" placeholder="Apelidos/tags (opcional)" 
                                class="w-full p-2 border-2 rounded-lg input-focus text-sm">
                        </div>
                        <div class="flex space-x-2 mt-3">
                            <button onclick="cadastrarClienteRapido('${cliente}', ${index})" 
                                class="btn-primary flex-1 py-2 rounded-lg text-white font-medium text-sm">
                                ‚úÖ Cadastrar Agora
                            </button>
                            <button onclick="adicionarClientePendente('${cliente}')" 
                                class="border-2 border-yellow-500 text-yellow-700 flex-1 py-2 rounded-lg font-medium text-sm hover:bg-yellow-50">
                                ‚è≥ Adicionar √† Lista
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('clientes-nao-encontrados').classList.add('hidden');
            }
            
            // Mostrar produtos n√£o encontrados
            if (produtosNaoEncontrados.length > 0) {
                document.getElementById('produtos-nao-encontrados').classList.remove('hidden');
                const listaProdutos = document.getElementById('lista-produtos-nao-encontrados');
                listaProdutos.innerHTML = produtosNaoEncontrados.map(produto => `
                    <div class="bg-white p-3 rounded-lg border border-red-200">
                        <div class="font-medium text-red-700">${produto.nome}</div>
                        <div class="text-sm text-gray-600">Linha ${produto.linha} - Cliente: ${produto.cliente}</div>
                        <div class="text-xs text-gray-500 mt-1">Verifique se o nome est√° correto ou cadastre o produto</div>
                    </div>
                `).join('');
            } else {
                document.getElementById('produtos-nao-encontrados').classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Fechar modal de valida√ß√£o
        function fecharModalValidacao() {
            document.getElementById('modal-validacao').classList.add('hidden');
            document.getElementById('modal-validacao').classList.remove('flex');
            vendasValidadasTemp = [];
        }

        // Cadastrar cliente rapidamente no modal
        function cadastrarClienteRapido(nomeCliente, index) {
            const celular = document.getElementById(`cliente-celular-${index}`).value.trim();
            const tags = document.getElementById(`cliente-tags-${index}`).value.split(',').map(t => t.trim()).filter(t => t);

            if (!celular) {
                alert('Por favor, informe o celular do cliente');
                return;
            }

            const cliente = {
                id: Date.now() + Math.random(),
                nome: nomeCliente,
                celular,
                tags: [...tags, nomeCliente.toLowerCase()]
            };

            clientes.push(cliente);
            localStorage.setItem('clientes', JSON.stringify(clientes));
            
            mostrarSucesso(`Cliente ${nomeCliente} cadastrado!`);
            
            // Remover da lista de n√£o encontrados visualmente
            const elemento = document.getElementById(`cliente-celular-${index}`).closest('.bg-white');
            elemento.style.opacity = '0.5';
            elemento.innerHTML = `<div class="text-center text-green-600 font-medium py-4">‚úÖ ${nomeCliente} cadastrado com sucesso!</div>`;
        }

        // Adicionar cliente individual √† lista de pendentes
        function adicionarClientePendente(nomeCliente) {
            if (!clientesPendentes.includes(nomeCliente)) {
                clientesPendentes.push(nomeCliente);
                localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
                atualizarListaClientesPendentes();
                mostrarSucesso(`${nomeCliente} adicionado √† lista de pendentes!`);
            }
        }

        // Adicionar clientes √† lista de pendentes (fun√ß√£o antiga mantida para compatibilidade)
        function adicionarClientesPendentes() {
            const clientesNaoEncontrados = Array.from(document.querySelectorAll('#lista-clientes-nao-encontrados .font-medium'))
                .map(el => el.textContent);
            
            clientesNaoEncontrados.forEach(cliente => {
                if (!clientesPendentes.includes(cliente)) {
                    clientesPendentes.push(cliente);
                }
            });
            
            localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
            atualizarListaClientesPendentes();
            mostrarSucesso('Clientes adicionados √† lista de pendentes!');
        }

        // Processar vendas validadas
        function processarVendasValidadas() {
            let vendasProcessadas = 0;
            
            vendasValidadasTemp.forEach(venda => {
                adicionarVenda(venda);
                vendasProcessadas++;
            });

            if (vendasProcessadas > 0) {
                document.getElementById('chat-input').value = '';
                atualizarListas();
                mostrarSucesso(`${vendasProcessadas} vendas processadas!`);
            }
            
            fecharModalValidacao();
        }

        // Adicionar produto ao cliente atual (venda individual)
        function adicionarProdutoCliente() {
            const cliente = document.getElementById('cliente-individual').value.trim();
            const quantidade = parseInt(document.getElementById('quantidade-individual').value);
            const status = document.getElementById('status-individual').value;
            const valorPago = parseFloat(document.getElementById('valor-individual').value) || 0;
            const sabor = document.getElementById('sabor-individual').value;

            if (!cliente) {
                alert('Por favor, selecione um cliente primeiro');
                return;
            }

            if (!produtoSelecionadoAtual || !quantidade) {
                alert('Por favor, selecione um produto e quantidade');
                return;
            }

            // Nome completo do produto com sabor se houver
            const nomeCompleto = sabor ? `${produtoSelecionadoAtual.nome} (${sabor})` : produtoSelecionadoAtual.nome;

            const itemVenda = {
                id: Date.now() + Math.random(),
                produto: nomeCompleto,
                produtoOriginal: produtoSelecionadoAtual.nome,
                produtoId: produtoSelecionadoAtual.id,
                sabor: sabor || null,
                quantidade,
                status,
                valorPago: status === 'pago-valor' ? valorPago : (status === 'pago' ? produtoSelecionadoAtual.preco * quantidade : 0),
                precoUnitario: produtoSelecionadoAtual.preco,
                total: produtoSelecionadoAtual.preco * quantidade
            };

            vendaIndividualAtual.push(itemVenda);
            
            // Limpar campos do produto
            document.getElementById('produto-busca-individual').value = '';
            document.getElementById('sabor-individual').innerHTML = '<option value="">Selecione primeiro o produto</option>';
            document.getElementById('sabor-individual').disabled = true;
            document.getElementById('preco-unitario-display').value = '';
            document.getElementById('quantidade-individual').value = '1';
            document.getElementById('status-individual').value = 'fiado';
            document.getElementById('status-display').value = 'üìù FIADO';
            document.getElementById('status-display').className = 'w-full p-2 border-2 rounded-lg bg-gray-100 text-gray-600 font-medium';
            document.getElementById('valor-individual').value = '';
            produtoSelecionadoAtual = null;
            
            atualizarProdutosClienteAtual();
        }

        // Finalizar venda individual
        function finalizarVendaIndividual() {
            const cliente = document.getElementById('cliente-individual').value.trim();
            
            if (!cliente) {
                alert('Por favor, selecione um cliente');
                return;
            }

            if (vendaIndividualAtual.length === 0) {
                alert('Adicione pelo menos um produto');
                return;
            }

            const clienteObj = encontrarCliente(cliente);
            if (!clienteObj) {
                mostrarModalCliente(cliente);
                return;
            }

            // Adicionar todas as vendas
            vendaIndividualAtual.forEach(item => {
                const venda = {
                    cliente: clienteObj.nome,
                    produto: item.produto,
                    quantidade: item.quantidade,
                    status: item.status,
                    valorPago: item.valorPago
                };
                adicionarVenda(venda);
            });

            limparVendaIndividual();
            atualizarListas();
            mostrarSucesso(`Venda finalizada para ${clienteObj.nome}!`);
        }

        // Limpar venda individual
        function limparVendaIndividual() {
            vendaIndividualAtual = [];
            document.getElementById('cliente-individual').value = '';
            document.getElementById('produto-busca-individual').value = '';
            document.getElementById('sabor-individual').innerHTML = '<option value="">Selecione primeiro o produto</option>';
            document.getElementById('sabor-individual').disabled = true;
            document.getElementById('preco-unitario-display').value = '';
            document.getElementById('quantidade-individual').value = '1';
            document.getElementById('status-individual').value = 'fiado';
            document.getElementById('status-display').value = 'üìù FIADO';
            document.getElementById('status-display').className = 'w-full p-2 border-2 rounded-lg bg-gray-100 text-gray-600 font-medium';
            document.getElementById('valor-individual').value = '';
            produtoSelecionadoAtual = null;
            atualizarProdutosClienteAtual();
        }

        // Busca inteligente de produtos com dropdown
        function buscarProdutosInteligente(termo) {
            const dropdown = document.getElementById('sugestoes-produtos-dropdown');
            const termoLower = termo.toLowerCase().trim();
            
            if (termo.length < 1) {
                dropdown.classList.add('hidden');
                return;
            }
            
            const produtosFiltrados = produtos.filter(produto => 
                produto.nome.toLowerCase().includes(termoLower) ||
                produto.tags.some(tag => tag.toLowerCase().includes(termoLower)) ||
                produto.categoria.toLowerCase().includes(termoLower)
            ).slice(0, 8); // Limitar a 8 resultados
            
            if (produtosFiltrados.length === 0) {
                dropdown.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <div class="text-2xl mb-2">üîç</div>
                        <div>Nenhum produto encontrado</div>
                        <div class="text-xs mt-1">Tente outro termo de busca</div>
                    </div>
                `;
                dropdown.classList.remove('hidden');
                return;
            }
            
            dropdown.innerHTML = produtosFiltrados.map(produto => `
                <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors duration-200" 
                     onclick="selecionarProdutoDropdown('${produto.nome}')">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-800">${produto.nome}</div>
                            <div class="text-xs text-gray-500 mt-1">
                                <span class="bg-gray-100 px-2 py-1 rounded">${produto.categoria}</span>
                                ${produto.sabores.length > 0 ? `<span class="ml-2 text-blue-600">${produto.sabores.length} sabores</span>` : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">R$ ${produto.preco.toFixed(2)}</div>
                            <div class="text-xs text-gray-400">unit√°rio</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            dropdown.classList.remove('hidden');
        }

        // Busca inteligente de clientes com dropdown
        function buscarClientesInteligente(termo) {
            const dropdown = document.getElementById('sugestoes-clientes-dropdown');
            const termoLower = termo.toLowerCase().trim();
            
            if (termo.length < 1) {
                dropdown.classList.add('hidden');
                return;
            }
            
            const clientesFiltrados = clientes.filter(cliente => 
                cliente.nome.toLowerCase().includes(termoLower) ||
                cliente.tags.some(tag => tag.toLowerCase().includes(termoLower)) ||
                cliente.celular.includes(termo)
            ).slice(0, 8); // Limitar a 8 resultados
            
            if (clientesFiltrados.length === 0) {
                dropdown.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <div class="text-2xl mb-2">üë§</div>
                        <div>Nenhum cliente encontrado</div>
                        <div class="text-xs mt-1">Tente outro termo de busca</div>
                    </div>
                `;
                dropdown.classList.remove('hidden');
                return;
            }
            
            dropdown.innerHTML = clientesFiltrados.map(cliente => {
                const dividaAtual = dividas[cliente.nome] || 0;
                const statusDivida = dividaAtual > 0 ? 'text-red-600' : dividaAtual < 0 ? 'text-blue-600' : 'text-green-600';
                const iconeDivida = dividaAtual > 0 ? '‚ö†Ô∏è' : dividaAtual < 0 ? 'üíé' : '‚úÖ';
                
                return `
                    <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors duration-200" 
                         onclick="selecionarClienteDropdown('${cliente.nome}')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium text-gray-800">${cliente.nome}</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    <span class="bg-gray-100 px-2 py-1 rounded">${cliente.celular}</span>
                                    ${cliente.tags.length > 1 ? `<span class="ml-2 text-purple-600">${cliente.tags.length - 1} tags</span>` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center space-x-1">
                                    <span class="text-sm">${iconeDivida}</span>
                                    <span class="font-bold ${statusDivida}">R$ ${Math.abs(dividaAtual).toFixed(2)}</span>
                                </div>
                                <div class="text-xs text-gray-400">
                                    ${dividaAtual > 0 ? 'deve' : dividaAtual < 0 ? 'cr√©dito' : 'em dia'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            dropdown.classList.remove('hidden');
        }

        // Mostrar sugest√µes ao focar
        function mostrarSugestoesProdutos() {
            const input = document.getElementById('produto-busca-individual');
            if (input.value.length > 0) {
                buscarProdutosInteligente(input.value);
            } else {
                // Mostrar todos os produtos se n√£o h√° termo de busca
                const dropdown = document.getElementById('sugestoes-produtos-dropdown');
                const produtosRecentes = produtos.slice(0, 6);
                
                dropdown.innerHTML = `
                    <div class="p-3 bg-gray-50 border-b border-gray-200">
                        <div class="text-sm font-medium text-gray-700">üì¶ Produtos Dispon√≠veis</div>
                    </div>
                    ${produtosRecentes.map(produto => `
                        <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors duration-200" 
                             onclick="selecionarProdutoDropdown('${produto.nome}')">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium text-gray-800">${produto.nome}</div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <span class="bg-gray-100 px-2 py-1 rounded">${produto.categoria}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-green-600">R$ ${produto.preco.toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
                
                dropdown.classList.remove('hidden');
            }
        }

        // Ocultar sugest√µes
        function ocultarSugestoesProdutos() {
            document.getElementById('sugestoes-produtos-dropdown').classList.add('hidden');
        }

        // Mostrar sugest√µes de clientes ao focar
        function mostrarSugestoesClientes() {
            const input = document.getElementById('cliente-individual');
            if (input.value.length > 0) {
                buscarClientesInteligente(input.value);
            } else {
                // Mostrar todos os clientes se n√£o h√° termo de busca
                const dropdown = document.getElementById('sugestoes-clientes-dropdown');
                const clientesRecentes = clientes.slice(0, 6);
                
                dropdown.innerHTML = `
                    <div class="p-3 bg-gray-50 border-b border-gray-200">
                        <div class="text-sm font-medium text-gray-700">üë• Clientes Dispon√≠veis</div>
                    </div>
                    ${clientesRecentes.map(cliente => {
                        const dividaAtual = dividas[cliente.nome] || 0;
                        const statusDivida = dividaAtual > 0 ? 'text-red-600' : dividaAtual < 0 ? 'text-blue-600' : 'text-green-600';
                        const iconeDivida = dividaAtual > 0 ? '‚ö†Ô∏è' : dividaAtual < 0 ? 'üíé' : '‚úÖ';
                        
                        return `
                            <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors duration-200" 
                                 onclick="selecionarClienteDropdown('${cliente.nome}')">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium text-gray-800">${cliente.nome}</div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            <span class="bg-gray-100 px-2 py-1 rounded">${cliente.celular}</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="flex items-center space-x-1">
                                            <span class="text-sm">${iconeDivida}</span>
                                            <span class="font-bold ${statusDivida}">R$ ${Math.abs(dividaAtual).toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                `;
                
                dropdown.classList.remove('hidden');
            }
        }

        // Ocultar sugest√µes de clientes
        function ocultarSugestoesClientes() {
            document.getElementById('sugestoes-clientes-dropdown').classList.add('hidden');
        }

        // Selecionar cliente do dropdown
        function selecionarClienteDropdown(nomeCliente) {
            const input = document.getElementById('cliente-individual');
            input.value = nomeCliente;
            input.focus();
            ocultarSugestoesClientes();
        }

        // Selecionar produto do dropdown
        function selecionarProdutoDropdown(nomeProduto) {
            const input = document.getElementById('produto-busca-individual');
            input.value = nomeProduto;
            selecionarProduto(nomeProduto);
            ocultarSugestoesProdutos();
            
            // Focar no pr√≥ximo campo (sabor ou quantidade)
            setTimeout(() => {
                const saborSelect = document.getElementById('sabor-individual');
                if (!saborSelect.disabled && saborSelect.options.length > 1) {
                    saborSelect.focus();
                } else {
                    document.getElementById('quantidade-individual').focus();
                }
            }, 100);
        }

        // Calcular status automaticamente baseado no valor pago
        function calcularStatusAutomatico() {
            const valorPago = parseFloat(document.getElementById('valor-individual').value) || 0;
            const quantidade = parseInt(document.getElementById('quantidade-individual').value) || 1;
            const statusDisplay = document.getElementById('status-display');
            const statusHidden = document.getElementById('status-individual');
            
            if (!produtoSelecionadoAtual) {
                statusDisplay.value = 'üìù FIADO';
                statusDisplay.className = 'w-full p-2 border-2 rounded-lg bg-gray-100 text-gray-600 font-medium';
                statusHidden.value = 'fiado';
                return;
            }
            
            const precoTotal = produtoSelecionadoAtual.preco * quantidade;
            
            if (valorPago === 0) {
                // Sem valor = fiado
                statusDisplay.value = 'üìù FIADO';
                statusDisplay.className = 'w-full p-2 border-2 rounded-lg bg-red-50 text-red-700 font-medium border-red-200';
                statusHidden.value = 'fiado';
            } else if (valorPago >= precoTotal) {
                if (valorPago === precoTotal) {
                    // Pagou exato
                    statusDisplay.value = '‚úÖ PAGO TOTAL';
                    statusDisplay.className = 'w-full p-2 border-2 rounded-lg bg-green-50 text-green-700 font-medium border-green-200';
                    statusHidden.value = 'pago';
                } else {
                    // Pagou mais (cr√©dito)
                    const credito = valorPago - precoTotal;
                    statusDisplay.value = `üíé PAGO + R$ ${credito.toFixed(2)} CR√âDITO`;
                    statusDisplay.className = 'w-full p-2 border-2 rounded-lg bg-blue-50 text-blue-700 font-medium border-blue-200';
                    statusHidden.value = 'pago-valor';
                }
            } else {
                // Pagou parcial
                const restante = precoTotal - valorPago;
                statusDisplay.value = `‚ö†Ô∏è PARCIAL - DEVE R$ ${restante.toFixed(2)}`;
                statusDisplay.className = 'w-full p-2 border-2 rounded-lg bg-yellow-50 text-yellow-700 font-medium border-yellow-200';
                statusHidden.value = 'pago-valor';
            }
        }

        // Selecionar produto
        function selecionarProduto(nomeProduto) {
            const produto = produtos.find(p => p.nome === nomeProduto);
            if (!produto) {
                produtoSelecionadoAtual = null;
                document.getElementById('sabor-individual').innerHTML = '<option value="">Produto n√£o encontrado</option>';
                document.getElementById('sabor-individual').disabled = true;
                document.getElementById('preco-unitario-display').value = '';
                calcularStatusAutomatico();
                return;
            }
            
            produtoSelecionadoAtual = produto;
            document.getElementById('preco-unitario-display').value = `R$ ${produto.preco.toFixed(2)}`;
            
            // Atualizar sabores
            const saborSelect = document.getElementById('sabor-individual');
            if (produto.sabores && produto.sabores.length > 0) {
                saborSelect.innerHTML = '<option value="">Sem sabor espec√≠fico</option>' +
                    produto.sabores.map(sabor => `<option value="${sabor}">${sabor}</option>`).join('');
                saborSelect.disabled = false;
            } else {
                saborSelect.innerHTML = '<option value="">Produto sem sabores</option>';
                saborSelect.disabled = true;
            }
            
            // Recalcular status automaticamente
            calcularStatusAutomatico();
        }

        // Editar produto
        function editarProduto(id) {
            const produto = produtos.find(p => p.id === id);
            if (!produto) return;
            
            produtoEditandoId = id;
            document.getElementById('editar-produto-nome').value = produto.nome;
            document.getElementById('editar-produto-preco').value = produto.preco;
            document.getElementById('editar-produto-categoria').value = produto.categoria;
            document.getElementById('editar-produto-sabores').value = produto.sabores.join(', ');
            document.getElementById('editar-produto-tags').value = produto.tags.filter(tag => tag !== produto.nome.toLowerCase()).join(', ');
            
            document.getElementById('modal-editar-produto').classList.remove('hidden');
            document.getElementById('modal-editar-produto').classList.add('flex');
        }

        // Salvar edi√ß√£o do produto
        function salvarEdicaoProduto() {
            const nome = document.getElementById('editar-produto-nome').value.trim();
            const preco = parseFloat(document.getElementById('editar-produto-preco').value);
            const categoria = document.getElementById('editar-produto-categoria').value;
            const sabores = document.getElementById('editar-produto-sabores').value.split(',').map(s => s.trim()).filter(s => s);
            const tags = document.getElementById('editar-produto-tags').value.split(',').map(t => t.trim()).filter(t => t);

            if (!nome || !preco || preco <= 0) {
                alert('Por favor, preencha todos os campos obrigat√≥rios');
                return;
            }

            // Verificar se outro produto j√° tem este nome
            const produtoExistente = produtos.find(p => p.id !== produtoEditandoId && p.nome.toLowerCase() === nome.toLowerCase());
            if (produtoExistente) {
                alert('J√° existe outro produto com este nome');
                return;
            }

            const produtoIndex = produtos.findIndex(p => p.id === produtoEditandoId);
            if (produtoIndex === -1) return;

            produtos[produtoIndex] = {
                ...produtos[produtoIndex],
                nome,
                preco,
                categoria,
                sabores,
                tags: [...tags, nome.toLowerCase()]
            };

            localStorage.setItem('produtos', JSON.stringify(produtos));
            fecharModalEditarProduto();
            atualizarListas();
            mostrarSucesso(`Produto "${nome}" atualizado com sucesso!`);
        }

        // Fechar modal de editar produto
        function fecharModalEditarProduto() {
            document.getElementById('modal-editar-produto').classList.add('hidden');
            document.getElementById('modal-editar-produto').classList.remove('flex');
            produtoEditandoId = null;
        }

        // Editar cliente
        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;
            
            clienteEditandoId = id;
            document.getElementById('editar-cliente-nome').value = cliente.nome;
            document.getElementById('editar-cliente-celular').value = cliente.celular;
            document.getElementById('editar-cliente-tags').value = cliente.tags.filter(tag => tag !== cliente.nome.toLowerCase()).join(', ');
            
            document.getElementById('modal-editar-cliente').classList.remove('hidden');
            document.getElementById('modal-editar-cliente').classList.add('flex');
        }

        // Salvar edi√ß√£o do cliente
        function salvarEdicaoCliente() {
            const nome = document.getElementById('editar-cliente-nome').value.trim();
            const celular = document.getElementById('editar-cliente-celular').value.trim();
            const tags = document.getElementById('editar-cliente-tags').value.split(',').map(t => t.trim()).filter(t => t);

            if (!nome || !celular) {
                alert('Por favor, preencha todos os campos obrigat√≥rios');
                return;
            }

            // Validar celular
            const celularLimpo = celular.replace(/\D/g, '');
            if (celularLimpo.length < 10 || celularLimpo.length > 11) {
                alert('Por favor, informe um n√∫mero de celular v√°lido');
                return;
            }

            // Verificar se outro cliente j√° tem este nome ou celular
            const clienteExistente = clientes.find(c => 
                c.id !== clienteEditandoId && 
                (c.nome.toLowerCase() === nome.toLowerCase() || c.celular.replace(/\D/g, '') === celularLimpo)
            );
            
            if (clienteExistente) {
                alert('J√° existe outro cliente com este nome ou celular');
                return;
            }

            const clienteIndex = clientes.findIndex(c => c.id === clienteEditandoId);
            if (clienteIndex === -1) return;

            const nomeAntigo = clientes[clienteIndex].nome;
            
            clientes[clienteIndex] = {
                ...clientes[clienteIndex],
                nome,
                celular,
                tags: [...tags, nome.toLowerCase()]
            };

            // Atualizar refer√™ncias nas d√≠vidas e hist√≥rico se o nome mudou
            if (nomeAntigo !== nome) {
                if (dividas[nomeAntigo]) {
                    dividas[nome] = dividas[nomeAntigo];
                    delete dividas[nomeAntigo];
                }
                
                historicoVendas.forEach(h => {
                    if (h.cliente === nomeAntigo) {
                        h.cliente = nome;
                    }
                });
                
                vendasDia.forEach(v => {
                    if (v.cliente === nomeAntigo) {
                        v.cliente = nome;
                    }
                });
                
                pagamentosAvulsos.forEach(p => {
                    if (p.cliente === nomeAntigo) {
                        p.cliente = nome;
                    }
                });
                
                localStorage.setItem('dividas', JSON.stringify(dividas));
                localStorage.setItem('historicoVendas', JSON.stringify(historicoVendas));
                localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
                localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
            }

            localStorage.setItem('clientes', JSON.stringify(clientes));
            fecharModalEditarCliente();
            atualizarListas();
            mostrarSucesso(`Cliente "${nome}" atualizado com sucesso!`);
        }

        // Fechar modal de editar cliente
        function fecharModalEditarCliente() {
            document.getElementById('modal-editar-cliente').classList.add('hidden');
            document.getElementById('modal-editar-cliente').classList.remove('flex');
            clienteEditandoId = null;
        }

        // Editar venda
        function editarVenda(id) {
            const venda = vendasDia.find(v => v.id == id);
            if (!venda) return;
            
            vendaEditandoId = id;
            
            // Buscar produto pelo nome original se dispon√≠vel
            const nomeBusca = venda.produtoOriginal || venda.produto;
            produtoVendaEditando = encontrarProduto(nomeBusca);
            
            // Preencher campos
            document.getElementById('editar-venda-cliente').value = venda.cliente;
            document.getElementById('editar-venda-produto').value = venda.produto;
            document.getElementById('editar-venda-quantidade').value = venda.quantidade;
            
            if (produtoVendaEditando) {
                document.getElementById('editar-venda-preco-display').value = `R$ ${produtoVendaEditando.preco.toFixed(2)}`;
            } else {
                document.getElementById('editar-venda-preco-display').value = 'Produto n√£o encontrado';
            }
            
            // Configurar status e valor pago
            document.getElementById('editar-venda-status').value = venda.status;
            document.getElementById('editar-venda-valor').value = venda.valorPago || 0;
            
            // Calcular status inicial
            calcularStatusEdicao();
            
            document.getElementById('modal-editar-venda').classList.remove('hidden');
            document.getElementById('modal-editar-venda').classList.add('flex');
        }

        // Calcular status na edi√ß√£o
        function calcularStatusEdicao() {
            const valorPago = parseFloat(document.getElementById('editar-venda-valor').value) || 0;
            const quantidade = parseInt(document.getElementById('editar-venda-quantidade').value) || 1;
            const statusDisplay = document.getElementById('editar-venda-status-display');
            const statusHidden = document.getElementById('editar-venda-status');
            
            if (!produtoVendaEditando) {
                statusDisplay.value = '‚ùå PRODUTO N√ÉO ENCONTRADO';
                statusDisplay.className = 'w-full p-3 border-2 rounded-lg bg-red-50 text-red-700 font-medium border-red-200';
                statusHidden.value = 'fiado';
                return;
            }
            
            const precoTotal = produtoVendaEditando.preco * quantidade;
            
            if (valorPago === 0) {
                // Sem valor = fiado
                statusDisplay.value = 'üìù FIADO';
                statusDisplay.className = 'w-full p-3 border-2 rounded-lg bg-red-50 text-red-700 font-medium border-red-200';
                statusHidden.value = 'fiado';
            } else if (valorPago >= precoTotal) {
                if (valorPago === precoTotal) {
                    // Pagou exato
                    statusDisplay.value = '‚úÖ PAGO TOTAL';
                    statusDisplay.className = 'w-full p-3 border-2 rounded-lg bg-green-50 text-green-700 font-medium border-green-200';
                    statusHidden.value = 'pago';
                } else {
                    // Pagou mais (cr√©dito)
                    const credito = valorPago - precoTotal;
                    statusDisplay.value = `üíé PAGO + R$ ${credito.toFixed(2)} CR√âDITO`;
                    statusDisplay.className = 'w-full p-3 border-2 rounded-lg bg-blue-50 text-blue-700 font-medium border-blue-200';
                    statusHidden.value = 'pago-valor';
                }
            } else {
                // Pagou parcial
                const restante = precoTotal - valorPago;
                statusDisplay.value = `‚ö†Ô∏è PARCIAL - DEVE R$ ${restante.toFixed(2)}`;
                statusDisplay.className = 'w-full p-3 border-2 rounded-lg bg-yellow-50 text-yellow-700 font-medium border-yellow-200';
                statusHidden.value = 'pago-valor';
            }
        }

        // Salvar edi√ß√£o da venda
        function salvarEdicaoVenda() {
            const quantidade = parseInt(document.getElementById('editar-venda-quantidade').value);
            const status = document.getElementById('editar-venda-status').value;
            const valorPago = parseFloat(document.getElementById('editar-venda-valor').value) || 0;

            if (!quantidade || quantidade < 1) {
                alert('Por favor, informe uma quantidade v√°lida');
                return;
            }

            if (!produtoVendaEditando) {
                alert('Produto n√£o encontrado. N√£o √© poss√≠vel salvar a edi√ß√£o.');
                return;
            }

            const vendaIndex = vendasDia.findIndex(v => v.id == vendaEditandoId);
            if (vendaIndex === -1) return;

            // Atualizar venda
            vendasDia[vendaIndex] = {
                ...vendasDia[vendaIndex],
                quantidade,
                status,
                valorPago: status === 'pago-valor' ? valorPago : (status === 'pago' ? produtoVendaEditando.preco * quantidade : 0)
            };

            localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
            fecharModalEditarVenda();
            atualizarListas();
            mostrarSucesso('Venda atualizada com sucesso!');
        }

        // Fechar modal de editar venda
        function fecharModalEditarVenda() {
            document.getElementById('modal-editar-venda').classList.add('hidden');
            document.getElementById('modal-editar-venda').classList.remove('flex');
            vendaEditandoId = null;
            produtoVendaEditando = null;
        }

        // Adicionar venda ao sistema
        function adicionarVenda(venda) {
            // Sempre usar o nome real do cliente, n√£o o apelido/tag
            const cliente = encontrarCliente(venda.cliente);
            const nomeReal = cliente ? cliente.nome : venda.cliente;
            
            const vendaCompleta = {
                ...venda,
                cliente: nomeReal, // Usar nome real
                id: Date.now() + Math.random(),
                data: new Date().toISOString(),
                dataFormatada: new Date().toLocaleDateString('pt-BR')
            };

            vendasDia.push(vendaCompleta);
            localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
        }

        // Adicionar pagamento avulso
        function adicionarPagamento() {
            const cliente = document.getElementById('pagamento-cliente').value.trim();
            const valor = parseFloat(document.getElementById('pagamento-valor').value);

            if (!cliente || !valor) {
                alert('Por favor, preencha cliente e valor');
                return;
            }

            const clienteObj = encontrarCliente(cliente);
            if (!clienteObj) {
                alert('Cliente n√£o encontrado. Cadastre-o primeiro.');
                return;
            }

            const pagamento = {
                id: Date.now(),
                cliente: clienteObj.nome, // Usar nome real
                valor,
                data: new Date().toISOString(),
                dataFormatada: new Date().toLocaleDateString('pt-BR')
            };

            pagamentosAvulsos.push(pagamento);
            localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
            
            document.getElementById('pagamento-cliente').value = '';
            document.getElementById('pagamento-valor').value = '';
            
            atualizarListas();
            mostrarSucesso('Pagamento registrado!');
        }

        // Encontrar cliente por nome ou tags
        function encontrarCliente(nome) {
            const nomeLower = nome.toLowerCase();
            return clientes.find(cliente => 
                cliente.nome.toLowerCase() === nomeLower ||
                cliente.tags.some(tag => tag.toLowerCase() === nomeLower)
            );
        }

        // Encontrar produto por nome ou tags
        function encontrarProduto(nome) {
            const nomeLower = nome.toLowerCase();
            return produtos.find(produto => 
                produto.nome.toLowerCase() === nomeLower ||
                produto.tags.some(tag => tag.toLowerCase() === nomeLower)
            );
        }

        // Encontrar produto com sabor identificado - SISTEMA MELHORADO
        function encontrarProdutoComSabor(nome) {
            const nomeLower = nome.toLowerCase().trim();
            
            // 1. Primeiro, tentar encontrar por sabor espec√≠fico (mais comum)
            for (const prod of produtos) {
                for (const sabor of prod.sabores) {
                    // Verificar se o nome digitado corresponde ao sabor
                    if (nomeLower === sabor.toLowerCase()) {
                        return { produto: prod, sabor: sabor };
                    }
                    
                    // Verificar tags espec√≠ficas do sabor
                    const tagsDoSabor = prod.tags.filter(tag => 
                        tag.toLowerCase().includes(sabor.toLowerCase()) ||
                        sabor.toLowerCase().includes(tag.toLowerCase())
                    );
                    
                    for (const tag of tagsDoSabor) {
                        if (nomeLower === tag.toLowerCase()) {
                            return { produto: prod, sabor: sabor };
                        }
                    }
                }
            }
            
            // 2. Tentar encontrar produto + sabor combinados
            const palavras = nomeLower.split(' ');
            if (palavras.length >= 2) {
                for (const prod of produtos) {
                    // Verificar se a primeira palavra √© o produto
                    const produtoMatch = prod.nome.toLowerCase() === palavras[0] ||
                                       prod.tags.some(tag => tag.toLowerCase() === palavras[0]);
                    
                    if (produtoMatch) {
                        // Verificar se a segunda palavra √© um sabor
                        const saborPalavra = palavras[1];
                        const saborEncontrado = prod.sabores.find(s => 
                            s.toLowerCase() === saborPalavra ||
                            s.toLowerCase().includes(saborPalavra) ||
                            saborPalavra.includes(s.toLowerCase())
                        );
                        
                        if (saborEncontrado) {
                            return { produto: prod, sabor: saborEncontrado };
                        }
                    }
                    
                    // Verificar ordem inversa: sabor + produto
                    const saborMatch = prod.sabores.find(s => s.toLowerCase() === palavras[0]);
                    if (saborMatch) {
                        const produtoMatch2 = prod.nome.toLowerCase() === palavras[1] ||
                                            prod.tags.some(tag => tag.toLowerCase() === palavras[1]);
                        if (produtoMatch2) {
                            return { produto: prod, sabor: saborMatch };
                        }
                    }
                }
            }
            
            // 3. Buscar apenas por produto (sem sabor espec√≠fico)
            let produto = produtos.find(p => 
                p.nome.toLowerCase() === nomeLower ||
                p.tags.some(tag => tag.toLowerCase() === nomeLower)
            );
            
            if (produto) {
                return { produto, sabor: null };
            }
            
            // 4. Busca parcial por produto
            produto = produtos.find(p => 
                p.nome.toLowerCase().includes(nomeLower) ||
                p.tags.some(tag => tag.toLowerCase().includes(nomeLower) && tag.length > 2)
            );
            
            if (produto) {
                return { produto, sabor: null };
            }
            
            return { produto: null, sabor: null };
        }

        // Finalizar dia e atualizar d√≠vidas
        function finalizarDia() {
            if (vendasDia.length === 0 && pagamentosAvulsos.length === 0) {
                alert('Nenhuma venda ou pagamento para processar');
                return;
            }

            // Processar vendas por cliente
            const vendasPorCliente = {};
            
            vendasDia.forEach(venda => {
                if (!vendasPorCliente[venda.cliente]) {
                    vendasPorCliente[venda.cliente] = {
                        vendas: [],
                        pagamentos: 0
                    };
                }
                vendasPorCliente[venda.cliente].vendas.push(venda);
            });

            // Adicionar pagamentos avulsos
            pagamentosAvulsos.forEach(pagamento => {
                if (!vendasPorCliente[pagamento.cliente]) {
                    vendasPorCliente[pagamento.cliente] = {
                        vendas: [],
                        pagamentos: 0
                    };
                }
                vendasPorCliente[pagamento.cliente].pagamentos += pagamento.valor;
            });

            // Atualizar d√≠vidas
            Object.keys(vendasPorCliente).forEach(nomeCliente => {
                const dadosCliente = vendasPorCliente[nomeCliente];
                const resultado = calcularDivida(dadosCliente);
                
                // Atualizar d√≠vida total do cliente
                const dividaAnterior = dividas[nomeCliente] || 0;
                dividas[nomeCliente] = dividaAnterior + resultado.novaDivida;
                
                // Salvar no hist√≥rico
                historicoVendas.push({
                    cliente: nomeCliente,
                    data: new Date().toISOString(),
                    vendas: dadosCliente.vendas,
                    pagamentos: dadosCliente.pagamentos || 0,
                    dividaAnterior,
                    dividaNova: dividas[nomeCliente],
                    totalVendas: resultado.totalVendas,
                    totalPago: resultado.totalPago
                });
            });

            // Salvar dados
            localStorage.setItem('dividas', JSON.stringify(dividas));
            localStorage.setItem('historicoVendas', JSON.stringify(historicoVendas));
            
            // Limpar vendas do dia
            vendasDia = [];
            pagamentosAvulsos = [];
            localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
            localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
            
            // Atualizar √∫ltima atualiza√ß√£o
            localStorage.setItem('ultimaAtualizacao', new Date().toISOString());
            
            atualizarListas();
            mostrarSucesso('Dia finalizado! D√≠vidas atualizadas.');
            
            // RECOMPENSA DOPAMIN√âRGICA M√ÅXIMA - Dia finalizado
            mostrarConquista(`DIA FINALIZADO!\n${Object.keys(vendasPorCliente).length} clientes atualizados`);
        }

        // Calcular d√≠vida de um cliente
        function calcularDivida(dadosCliente) {
            let totalVendas = 0;
            let totalPago = 0;

            dadosCliente.vendas.forEach(venda => {
                // Buscar produto pelo nome original se dispon√≠vel
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                totalVendas += totalVenda;
                
                if (venda.status === 'pago') {
                    // PAGO sem valor = pagou o valor total do produto
                    totalPago += totalVenda;
                } else if (venda.status === 'pago-valor') {
                    // PAGO com valor espec√≠fico = pagou o valor informado
                    totalPago += venda.valorPago || 0;
                }
                // Se status === 'fiado', n√£o adiciona nada ao totalPago
            });

            // Adicionar pagamentos avulsos
            totalPago += dadosCliente.pagamentos || 0;
            
            return {
                totalVendas,
                totalPago,
                novaDivida: totalVendas - totalPago
            };
        }

        // Atualizar lista de clientes pendentes
        function atualizarListaClientesPendentes() {
            const section = document.getElementById('clientes-pendentes-section');
            const lista = document.getElementById('lista-clientes-pendentes');
            
            if (clientesPendentes.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            lista.innerHTML = clientesPendentes.map(cliente => `
                <div class="bg-white p-3 rounded-lg border border-yellow-300 flex justify-between items-center">
                    <span class="font-medium">${cliente}</span>
                    <div class="flex space-x-2">
                        <button onclick="cadastrarClientePendente('${cliente}')" class="btn-primary px-3 py-1 rounded text-white text-sm">
                            ‚úÖ Cadastrar
                        </button>
                        <button onclick="removerClientePendente('${cliente}')" class="text-red-500 hover:text-red-700 text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Atualizar produtos do cliente atual (venda individual)
        function atualizarProdutosClienteAtual() {
            const lista = document.getElementById('produtos-cliente-atual');
            
            if (vendaIndividualAtual.length === 0) {
                lista.innerHTML = '';
                return;
            }
            
            let totalGeral = 0;
            let totalPago = 0;
            
            lista.innerHTML = vendaIndividualAtual.map(item => {
                totalGeral += item.total;
                totalPago += item.valorPago;
                
                let statusHtml = '';
                if (item.status === 'pago') {
                    statusHtml = '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">PAGO</span>';
                } else if (item.status === 'pago-valor') {
                    statusHtml = `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">PAGO R$ ${item.valorPago.toFixed(2)}</span>`;
                } else {
                    statusHtml = '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs">FIADO</span>';
                }
                
                return `
                    <div class="bg-white p-3 rounded-lg border flex justify-between items-center">
                        <div>
                            <span class="font-medium">${item.quantidade}x ${item.produto}</span>
                            <span class="text-green-600 font-semibold ml-2">R$ ${item.total.toFixed(2)}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${statusHtml}
                            <button onclick="removerProdutoCliente('${item.id}')" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('') + `
                <div class="bg-gray-100 p-3 rounded-lg border-2 border-gray-300">
                    <div class="flex justify-between items-center font-bold">
                        <span>Total: R$ ${totalGeral.toFixed(2)}</span>
                        <span class="text-green-600">Pago: R$ ${totalPago.toFixed(2)}</span>
                        <span class="text-red-600">Restante: R$ ${(totalGeral - totalPago).toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        // Atualizar sugest√µes de produtos
        function atualizarSugestoesProdutos() {
            const datalist = document.getElementById('produtos-sugestoes');
            if (!datalist) return;
            
            datalist.innerHTML = produtos.map(produto => 
                `<option value="${produto.nome}">${produto.nome} - R$ ${produto.preco.toFixed(2)}</option>`
            ).join('');
        }

        // Cadastrar cliente pendente
        function cadastrarClientePendente(nomeCliente) {
            document.getElementById('cliente-nome').value = nomeCliente;
            showTab('clientes');
            removerClientePendente(nomeCliente);
        }

        // Remover cliente pendente
        function removerClientePendente(nomeCliente) {
            clientesPendentes = clientesPendentes.filter(c => c !== nomeCliente);
            localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
            atualizarListaClientesPendentes();
        }

        // Limpar clientes pendentes
        function limparClientesPendentes() {
            if (confirm('Tem certeza que deseja limpar toda a lista de clientes pendentes?')) {
                clientesPendentes = [];
                localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
                atualizarListaClientesPendentes();
                mostrarSucesso('Lista de clientes pendentes limpa!');
            }
        }

        // Remover produto do cliente atual
        function removerProdutoCliente(itemId) {
            vendaIndividualAtual = vendaIndividualAtual.filter(item => item.id !== itemId);
            atualizarProdutosClienteAtual();
        }

        // Mostrar modal para cliente n√£o cadastrado
        function mostrarModalCliente(nomeCliente) {
            document.getElementById('cliente-nao-encontrado').textContent = nomeCliente;
            document.getElementById('modal-cliente').classList.remove('hidden');
            document.getElementById('modal-cliente').classList.add('flex');
        }

        // Cadastrar cliente via modal
        function cadastrarClienteModal() {
            const nome = document.getElementById('cliente-nao-encontrado').textContent;
            const celular = document.getElementById('modal-celular').value.trim();
            const tags = document.getElementById('modal-tags').value.split(',').map(t => t.trim()).filter(t => t);

            if (!celular) {
                alert('Por favor, informe o celular do cliente');
                return;
            }

            const cliente = {
                id: Date.now(),
                nome,
                celular,
                tags: [...tags, nome.toLowerCase()]
            };

            clientes.push(cliente);
            localStorage.setItem('clientes', JSON.stringify(clientes));
            
            fecharModal();
            atualizarListas();
            mostrarSucesso('Cliente cadastrado! Continue com a venda.');
        }

        // Fechar modal
        function fecharModal() {
            document.getElementById('modal-cliente').classList.add('hidden');
            document.getElementById('modal-cliente').classList.remove('flex');
            document.getElementById('modal-celular').value = '';
            document.getElementById('modal-tags').value = '';
        }

        // Mostrar perfil do cliente
        function mostrarPerfil(nomeCliente) {
            const cliente = encontrarCliente(nomeCliente);
            if (!cliente) return;

            document.getElementById('perfil-nome').textContent = cliente.nome;
            document.getElementById('perfil-celular').textContent = cliente.celular;
            document.getElementById('perfil-tags').textContent = cliente.tags.join(', ');
            
            const dividaAtual = dividas[cliente.nome] || 0;
            const perfilDivida = document.getElementById('perfil-divida');
            perfilDivida.textContent = `R$ ${dividaAtual.toFixed(2)}`;
            perfilDivida.className = dividaAtual > 0 ? 'debt-positive' : (dividaAtual < 0 ? 'debt-negative' : 'debt-zero');

            // Hist√≥rico - ordenar por data mais recente primeiro
            const historico = historicoVendas
                .filter(h => h.cliente === cliente.nome)
                .sort((a, b) => new Date(b.data) - new Date(a.data));
            
            const historicoHtml = historico.map(h => {
                let totalVendasDia = 0;
                let totalPagoDia = 0;
                
                const vendasDetalhadas = h.vendas.map(v => {
                    // Buscar produto pelo nome original se dispon√≠vel
                    const nomeBusca = v.produtoOriginal || v.produto;
                    const produto = encontrarProduto(nomeBusca);
                    const precoUnitario = produto ? produto.preco : 0;
                    const totalVenda = precoUnitario * v.quantidade;
                    
                    totalVendasDia += totalVenda;
                    
                    let valorPagoVenda = 0;
                    let statusTexto = '';
                    
                    if (v.status === 'pago') {
                        valorPagoVenda = totalVenda;
                        statusTexto = ' ‚úÖ';
                    } else if (v.status === 'pago-valor') {
                        valorPagoVenda = v.valorPago || 0;
                        if (valorPagoVenda >= totalVenda) {
                            statusTexto = ' ‚úÖ';
                        } else {
                            statusTexto = ` üí∞R$${valorPagoVenda.toFixed(2)}`;
                        }
                    } else {
                        statusTexto = ' üìù';
                    }
                    
                    totalPagoDia += valorPagoVenda;
                    
                    return `<div class="flex justify-between items-center">
                        <span>${v.quantidade}x ${v.produto}${statusTexto}</span>
                        <span class="text-gray-600">R$ ${totalVenda.toFixed(2)}</span>
                    </div>`;
                }).join('');
                
                const dataCompleta = new Date(h.data);
                const dataFormatada = dataCompleta.toLocaleDateString('pt-BR');
                const horaFormatada = dataCompleta.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <div class="flex justify-between items-center mb-3">
                            <div>
                                <span class="font-semibold text-gray-800">${dataFormatada}</span>
                                <span class="text-sm text-gray-600 ml-2">${horaFormatada}</span>
                            </div>
                            <div class="text-right text-sm">
                                <div class="text-gray-600">D√≠vida Final: <span class="font-medium">R$ ${h.dividaNova.toFixed(2)}</span></div>
                                <button onclick="enviarWhatsAppHistorico('${cliente.nome}', '${h.data}')" 
                                    class="mt-1 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">
                                    üì± Enviar WhatsApp
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-2 mb-3">
                            ${vendasDetalhadas}
                        </div>
                        
                        <div class="border-t pt-2 mt-2">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <div class="text-gray-600">Total Vendas:</div>
                                    <div class="font-semibold text-gray-800">R$ ${totalVendasDia.toFixed(2)}</div>
                                </div>
                                <div>
                                    <div class="text-gray-600">Total Pago:</div>
                                    <div class="font-semibold text-green-600">R$ ${(totalPagoDia + (h.pagamentos || 0)).toFixed(2)}</div>
                                </div>
                            </div>
                            ${h.pagamentos > 0 ? `
                                <div class="mt-2 text-sm">
                                    <div class="text-blue-600">üí≥ Pagamento Avulso: R$ ${h.pagamentos.toFixed(2)}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('perfil-historico').innerHTML = historico.length > 0 ? historicoHtml : 
                '<p class="text-gray-500 text-center py-4">Nenhuma compra registrada</p>';

            // Configurar bot√£o WhatsApp
            document.getElementById('btn-whatsapp').onclick = () => enviarWhatsApp(cliente);

            document.getElementById('modal-perfil').classList.remove('hidden');
            document.getElementById('modal-perfil').classList.add('flex');
        }

        // Fechar modal de perfil
        function fecharPerfilModal() {
            document.getElementById('modal-perfil').classList.add('hidden');
            document.getElementById('modal-perfil').classList.remove('flex');
        }

        // Enviar WhatsApp (vers√£o atual - mais recente)
        function enviarWhatsApp(cliente) {
            if (!cliente) return;

            const dividaAtual = dividas[cliente.nome] || 0;
            
            // Buscar a compra mais recente do hist√≥rico
            const historicoCliente = historicoVendas
                .filter(h => h.cliente === cliente.nome)
                .sort((a, b) => new Date(b.data) - new Date(a.data));
            
            if (historicoCliente.length === 0) {
                mostrarErro('Nenhum hist√≥rico encontrado para este cliente');
                return;
            }
            
            const ultimaCompra = historicoCliente[0];
            const mensagem = gerarMensagemWhatsApp(ultimaCompra, cliente);

            const numeroLimpo = cliente.celular.replace(/\D/g, '');
            const url = `https://wa.me/55${numeroLimpo}?text=${encodeURIComponent(mensagem)}`;
            
            window.open(url, '_blank');
        }

        // Gerar mensagem WhatsApp baseada nas configura√ß√µes
        function gerarMensagemWhatsApp(registroHistorico, cliente) {
            const dataCompleta = new Date(registroHistorico.data);
            
            // Hora
            const hora = configuracoes.whatsapp.incluirHora ? 
                dataCompleta.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) : '';
            
            // Data formatada
            let dataFormatada = '';
            if (configuracoes.whatsapp.formatoData === 'dd/mm') {
                dataFormatada = `${dataCompleta.getDate().toString().padStart(2, '0')}/${(dataCompleta.getMonth() + 1).toString().padStart(2, '0')}`;
            } else if (configuracoes.whatsapp.formatoData === 'dd/mm/yyyy') {
                dataFormatada = dataCompleta.toLocaleDateString('pt-BR');
            } else {
                dataFormatada = dataCompleta.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
            }
            
            // Produtos
            let produtosTexto = '';
            registroHistorico.vendas.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const total = precoUnitario * venda.quantidade;
                produtosTexto += `${venda.quantidade} ${venda.produto} (${total.toFixed(2)})\n`;
            });
            
            // Pagamentos
            let totalPago = 0;
            registroHistorico.vendas.forEach(venda => {
                if (venda.status === 'pago') {
                    const nomeBusca = venda.produtoOriginal || venda.produto;
                    const produto = encontrarProduto(nomeBusca);
                    const precoUnitario = produto ? produto.preco : 0;
                    totalPago += precoUnitario * venda.quantidade;
                } else if (venda.status === 'pago-valor') {
                    totalPago += venda.valorPago || 0;
                }
            });
            totalPago += registroHistorico.pagamentos || 0;
            
            const pagamentosTexto = totalPago > 0 ? `PAGO ${totalPago.toFixed(2)}` : '';
            
            // Verificar se deve mostrar mesmo com d√≠vida zero
            const dividaFinal = registroHistorico.dividaNova;
            if (!configuracoes.whatsapp.mostrarDividaZero && Math.abs(dividaFinal) < 0.01) {
                return 'Cliente est√° em dia! ‚úÖ';
            }
            
            // Aplicar template
            let mensagem = configuracoes.whatsapp.mensagemPrincipal
                .replace('{hora}', hora)
                .replace('{dividaAnterior}', registroHistorico.dividaAnterior.toFixed(2))
                .replace('{data}', dataFormatada)
                .replace('{produtos}', produtosTexto.trim())
                .replace('{pagamentos}', pagamentosTexto)
                .replace('{dividaTotal}', dividaFinal.toFixed(2));
            
            return mensagem;
        }

        // Enviar WhatsApp do hist√≥rico espec√≠fico
        function enviarWhatsAppHistorico(nomeCliente, dataHistorico) {
            const cliente = encontrarCliente(nomeCliente);
            if (!cliente) return;

            // Buscar o registro espec√≠fico do hist√≥rico
            const registroHistorico = historicoVendas.find(h => 
                h.cliente === nomeCliente && h.data === dataHistorico
            );
            
            if (!registroHistorico) return;

            const mensagem = gerarMensagemWhatsApp(registroHistorico, cliente);

            const numeroLimpo = cliente.celular.replace(/\D/g, '');
            const url = `https://wa.me/55${numeroLimpo}?text=${encodeURIComponent(mensagem)}`;
            
            window.open(url, '_blank');
        }

        // Fun√ß√£o auxiliar para calcular total de vendas de hoje
        function calcularTotalVendasHoje(nomeCliente) {
            const hoje = new Date().toDateString();
            const vendasHoje = vendasDia.filter(v => v.cliente === nomeCliente && new Date(v.data).toDateString() === hoje);
            
            return vendasHoje.reduce((total, venda) => {
                // Buscar produto pelo nome original se dispon√≠vel
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                return total + (precoUnitario * venda.quantidade);
            }, 0);
        }

        // Fun√ß√£o auxiliar para calcular total de pagamentos de hoje
        function calcularTotalPagamentosHoje(nomeCliente) {
            const hoje = new Date().toDateString();
            const pagamentosHoje = pagamentosAvulsos.filter(p => p.cliente === nomeCliente && new Date(p.data).toDateString() === hoje);
            
            let totalPago = 0;
            
            // Pagamentos das vendas
            const vendasHoje = vendasDia.filter(v => v.cliente === nomeCliente && new Date(v.data).toDateString() === hoje);
            vendasHoje.forEach(venda => {
                if (venda.status === 'pago') {
                    // PAGO sem valor = pagou o valor total do produto
                    const nomeBusca = venda.produtoOriginal || venda.produto;
                    const produto = encontrarProduto(nomeBusca);
                    const precoUnitario = produto ? produto.preco : 0;
                    totalPago += precoUnitario * venda.quantidade;
                } else if (venda.status === 'pago-valor') {
                    // PAGO com valor espec√≠fico = pagou o valor informado
                    totalPago += venda.valorPago || 0;
                }
                // Se fiado, n√£o adiciona nada
            });
            
            // Pagamentos avulsos
            totalPago += pagamentosHoje.reduce((sum, p) => sum + p.valor, 0);
            
            return totalPago;
        }

        // Atualizar todas as listas
        function atualizarListas() {
            atualizarListaProdutos();
            atualizarListaClientes();
            atualizarVendasDia();
            atualizarPagamentosAvulsos();
            atualizarListaDividas();
            atualizarDataLists();
            atualizarResumos();
            atualizarListaClientesPendentes();
            atualizarProdutosClienteAtual();
            atualizarSugestoesProdutos();
            
            // Atualizar relat√≥rios se estiver na aba de relat√≥rios
            if (!document.getElementById('relatorios-tab').classList.contains('hidden')) {
                setTimeout(() => {
                    aplicarFiltroRelatorio();
                }, 100);
            }
            
            // Reaplicar classes Netflix se necess√°rio
            if (configuracoes.visual.modoNetflix) {
                setTimeout(() => {
                    aplicarAnimacoesNetflix();
                }, 100);
            }
        }

        // Atualizar lista de produtos
        function atualizarListaProdutos() {
            const lista = document.getElementById('lista-produtos');
            if (produtos.length === 0) {
                lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum produto cadastrado</p>';
                return;
            }

            lista.innerHTML = produtos.map(produto => `
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-semibold text-lg">${produto.nome}</h3>
                            <p class="text-green-600 font-bold">R$ ${produto.preco.toFixed(2)}</p>
                            <p class="text-sm text-gray-600">Categoria: ${produto.categoria}</p>
                            ${produto.sabores.length > 0 ? `<p class="text-sm text-gray-600">Sabores: ${produto.sabores.join(', ')}</p>` : ''}
                            ${produto.tags.length > 0 ? `<p class="text-sm text-gray-500">Tags: ${produto.tags.join(', ')}</p>` : ''}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editarProduto(${produto.id})" class="text-blue-500 hover:text-blue-700 font-bold">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="excluirProduto(${produto.id})" class="text-red-500 hover:text-red-700 font-bold">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Atualizar lista de clientes
        function atualizarListaClientes() {
            const lista = document.getElementById('lista-clientes');
            if (clientes.length === 0) {
                lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum cliente cadastrado</p>';
                return;
            }

            lista.innerHTML = clientes.map(cliente => {
                const dividaAtual = dividas[cliente.nome] || 0;
                const classeDivida = dividaAtual > 0 ? 'debt-positive' : (dividaAtual < 0 ? 'debt-negative' : 'debt-zero');
                
                return `
                    <div class="bg-gray-50 p-4 rounded-lg border hover:bg-gray-100 cursor-pointer" onclick="mostrarPerfil('${cliente.nome}')">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-lg">${cliente.nome}</h3>
                                <p class="text-sm text-gray-600">${cliente.celular}</p>
                                <p class="text-sm ${classeDivida}">D√≠vida: R$ ${dividaAtual.toFixed(2)}</p>
                                ${cliente.tags.length > 0 ? `<p class="text-sm text-gray-500">Tags: ${cliente.tags.join(', ')}</p>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="event.stopPropagation(); editarCliente(${cliente.id})" class="text-blue-500 hover:text-blue-700 font-bold">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="event.stopPropagation(); excluirCliente(${cliente.id})" class="text-red-500 hover:text-red-700 font-bold">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar vendas do dia
        function atualizarVendasDia() {
            const lista = document.getElementById('vendas-hoje');
            if (vendasDia.length === 0) {
                lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma venda registrada hoje</p>';
                return;
            }

            lista.innerHTML = vendasDia.map(venda => {
                // Buscar produto pelo nome original se dispon√≠vel, sen√£o pelo nome completo
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const total = precoUnitario * venda.quantidade;
                
                let statusHtml = '';
                let valorPagoInfo = '';
                let statusClass = '';
                
                if (venda.status === 'pago') {
                    // PAGO sem valor = pagou tudo
                    statusHtml = '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1"><span>‚úÖ</span><span>PAGO TOTAL</span></span>';
                    valorPagoInfo = `<div class="bg-green-50 p-2 rounded-lg border border-green-200">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-green-700 font-medium">üí∞ Valor Pago:</span>
                            <span class="text-green-800 font-bold">R$ ${total.toFixed(2)}</span>
                        </div>
                        <div class="text-xs text-green-600 mt-1">‚úÖ Pagamento completo realizado</div>
                    </div>`;
                    statusClass = 'border-green-500';
                } else if (venda.status === 'pago-valor') {
                    const valorPago = venda.valorPago || 0;
                    const diferenca = valorPago - total;
                    
                    if (diferenca > 0) {
                        // Pagou mais que o valor (cr√©dito/troco)
                        statusHtml = '<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1"><span>üíé</span><span>PAGO + CR√âDITO</span></span>';
                        valorPagoInfo = `<div class="bg-blue-50 p-2 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-between text-sm mb-1">
                                <span class="text-blue-700 font-medium">üí∞ Valor Pago:</span>
                                <span class="text-blue-800 font-bold">R$ ${valorPago.toFixed(2)}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-blue-700 font-medium">üéÅ Cr√©dito Gerado:</span>
                                <span class="text-blue-800 font-bold">R$ ${diferenca.toFixed(2)}</span>
                            </div>
                            <div class="text-xs text-blue-600 mt-1">üíé Cliente tem cr√©dito dispon√≠vel</div>
                        </div>`;
                        statusClass = 'border-blue-500';
                    } else if (diferenca < 0) {
                        // Pagou menos que o valor (deve o resto)
                        const restante = Math.abs(diferenca);
                        statusHtml = '<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1"><span>‚ö†Ô∏è</span><span>PARCIAL</span></span>';
                        valorPagoInfo = `<div class="bg-yellow-50 p-2 rounded-lg border border-yellow-200">
                            <div class="flex items-center justify-between text-sm mb-1">
                                <span class="text-yellow-700 font-medium">üí∞ Valor Pago:</span>
                                <span class="text-yellow-800 font-bold">R$ ${valorPago.toFixed(2)}</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-red-700 font-medium">‚è≥ Ainda Deve:</span>
                                <span class="text-red-800 font-bold">R$ ${restante.toFixed(2)}</span>
                            </div>
                            <div class="text-xs text-yellow-600 mt-1">‚ö†Ô∏è Pagamento parcial realizado</div>
                        </div>`;
                        statusClass = 'border-yellow-500';
                    } else {
                        // Pagou exatamente o valor
                        statusHtml = '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1"><span>‚úÖ</span><span>PAGO EXATO</span></span>';
                        valorPagoInfo = `<div class="bg-green-50 p-2 rounded-lg border border-green-200">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-green-700 font-medium">üí∞ Valor Pago:</span>
                                <span class="text-green-800 font-bold">R$ ${valorPago.toFixed(2)}</span>
                            </div>
                            <div class="text-xs text-green-600 mt-1">‚úÖ Valor exato pago</div>
                        </div>`;
                        statusClass = 'border-green-500';
                    }
                } else {
                    // Fiado
                    statusHtml = '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1"><span>üìù</span><span>FIADO</span></span>';
                    valorPagoInfo = `<div class="bg-red-50 p-2 rounded-lg border border-red-200">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-red-700 font-medium">‚è≥ A Pagar:</span>
                            <span class="text-red-800 font-bold">R$ ${total.toFixed(2)}</span>
                        </div>
                        <div class="text-xs text-red-600 mt-1">üìù Venda realizada a prazo</div>
                    </div>`;
                    statusClass = 'border-red-500';
                }

                const dataVenda = new Date(venda.data);
                const horaVenda = dataVenda.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="bg-white p-4 rounded-xl border-2 ${statusClass} shadow-sm hover:shadow-md transition-all duration-200">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <!-- Header da venda -->
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span class="font-bold text-gray-800 text-lg">${venda.cliente}</span>
                                        <span class="text-gray-400">‚Ä¢</span>
                                        <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${horaVenda}</span>
                                    </div>
                                    ${statusHtml}
                                </div>
                                
                                <!-- Produto e quantidade -->
                                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <span class="font-medium text-gray-800">${venda.quantidade}x ${venda.produto}</span>
                                            ${precoUnitario > 0 ? `<div class="text-xs text-gray-500 mt-1">R$ ${precoUnitario.toFixed(2)} cada</div>` : ''}
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-lg text-gray-800">R$ ${total.toFixed(2)}</div>
                                            <div class="text-xs text-gray-500">Total</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Informa√ß√µes de pagamento -->
                                ${valorPagoInfo}
                            </div>
                            
                            <!-- Bot√µes de a√ß√£o -->
                            <div class="flex flex-col space-y-2 ml-4">
                                <button onclick="editarVenda('${venda.id}')" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-1" 
                                    title="Editar venda">
                                    <span>‚úèÔ∏è</span>
                                    <span>Editar</span>
                                </button>
                                <button onclick="excluirVenda('${venda.id}')" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-1" 
                                    title="Excluir venda">
                                    <span>üóëÔ∏è</span>
                                    <span>Excluir</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar pagamentos avulsos
        function atualizarPagamentosAvulsos() {
            const lista = document.getElementById('pagamentos-avulsos');
            if (pagamentosAvulsos.length === 0) {
                lista.innerHTML = '';
                return;
            }

            lista.innerHTML = pagamentosAvulsos.map(pagamento => {
                const dataPagamento = new Date(pagamento.data);
                const horaPagamento = dataPagamento.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="bg-white p-4 rounded-xl border-2 border-green-500 shadow-sm hover:shadow-md transition-all duration-200">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <!-- Header do pagamento -->
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span class="font-bold text-gray-800 text-lg">${pagamento.cliente}</span>
                                        <span class="text-gray-400">‚Ä¢</span>
                                        <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${horaPagamento}</span>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold flex items-center space-x-1">
                                        <span>üí∞</span><span>PAGAMENTO</span>
                                    </span>
                                </div>
                                
                                <!-- Valor do pagamento -->
                                <div class="bg-green-50 p-3 rounded-lg mb-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <span class="font-medium text-gray-800">Pagamento Avulso</span>
                                            <div class="text-xs text-gray-500 mt-1">Reduz d√≠vida do cliente</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-lg text-green-600">+ R$ ${pagamento.valor.toFixed(2)}</div>
                                            <div class="text-xs text-gray-500">Cr√©dito</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Informa√ß√µes adicionais -->
                                <div class="bg-green-50 p-2 rounded-lg border border-green-200">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-green-700 font-medium">üí≥ Valor Recebido:</span>
                                        <span class="text-green-800 font-bold">R$ ${pagamento.valor.toFixed(2)}</span>
                                    </div>
                                    <div class="text-xs text-green-600 mt-1">‚úÖ Pagamento registrado com sucesso</div>
                                </div>
                            </div>
                            
                            <!-- Bot√£o de a√ß√£o -->
                            <div class="flex flex-col ml-4">
                                <button onclick="excluirPagamento(${pagamento.id})" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-1" 
                                    title="Excluir pagamento">
                                    <span>üóëÔ∏è</span>
                                    <span>Excluir</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar lista de d√≠vidas
        function atualizarListaDividas() {
            const lista = document.getElementById('lista-dividas');
            
            // Incluir TODOS os clientes, mesmo os com d√≠vida zero
            const todosClientes = clientes.map(cliente => ({
                nome: cliente.nome,
                cliente: cliente,
                divida: dividas[cliente.nome] || 0
            }));
            
            if (todosClientes.length === 0) {
                lista.innerHTML = `
                    <div class="flex items-center justify-center py-16">
                        <div class="text-center">
                            <div class="text-6xl mb-4">üë•</div>
                            <p class="text-gray-500 text-lg">Nenhum cliente cadastrado</p>
                            <p class="text-gray-400 text-sm mt-2">Cadastre clientes para acompanhar suas d√≠vidas</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Ordenar: primeiro os que devem (maior d√≠vida), depois os em dia, depois os com cr√©dito
            const clientesOrdenados = todosClientes.sort((a, b) => {
                if (a.divida > 0 && b.divida <= 0) return -1;
                if (a.divida <= 0 && b.divida > 0) return 1;
                if (a.divida > 0 && b.divida > 0) return b.divida - a.divida;
                if (a.divida < 0 && b.divida < 0) return a.divida - b.divida;
                return a.nome.localeCompare(b.nome);
            });

            // Separar clientes por categoria
            const clientesDevem = clientesOrdenados.filter(c => c.divida > 0);
            const clientesCredito = clientesOrdenados.filter(c => c.divida < 0);
            const clientesEmDia = clientesOrdenados.filter(c => c.divida === 0);

            let htmlFinal = '';

            // Se√ß√£o de clientes que devem
            if (clientesDevem.length > 0) {
                htmlFinal += `
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-red-700 flex items-center">
                                <span class="bg-red-100 p-2 rounded-full mr-3">‚ö†Ô∏è</span>
                                Clientes em D√©bito (${clientesDevem.length})
                            </h3>
                            <div class="text-sm text-red-600 font-medium">
                                Total: R$ ${clientesDevem.reduce((sum, c) => sum + c.divida, 0).toFixed(2)}
                            </div>
                        </div>
                        <div class="grid gap-4">
                            ${clientesDevem.map(({nome, cliente, divida}) => criarCardCliente(nome, cliente, divida, 'deve')).join('')}
                        </div>
                    </div>
                `;
            }

            // Se√ß√£o de clientes com cr√©dito
            if (clientesCredito.length > 0) {
                htmlFinal += `
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-blue-700 flex items-center">
                                <span class="bg-blue-100 p-2 rounded-full mr-3">üíé</span>
                                Clientes com Cr√©dito (${clientesCredito.length})
                            </h3>
                            <div class="text-sm text-blue-600 font-medium">
                                Total: R$ ${Math.abs(clientesCredito.reduce((sum, c) => sum + c.divida, 0)).toFixed(2)}
                            </div>
                        </div>
                        <div class="grid gap-4">
                            ${clientesCredito.map(({nome, cliente, divida}) => criarCardCliente(nome, cliente, divida, 'credito')).join('')}
                        </div>
                    </div>
                `;
            }

            // Se√ß√£o de clientes em dia
            if (clientesEmDia.length > 0) {
                htmlFinal += `
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-green-700 flex items-center">
                                <span class="bg-green-100 p-2 rounded-full mr-3">‚úÖ</span>
                                Clientes em Dia (${clientesEmDia.length})
                            </h3>
                            <div class="text-sm text-green-600 font-medium">
                                Sem pend√™ncias
                            </div>
                        </div>
                        <div class="grid gap-4">
                            ${clientesEmDia.map(({nome, cliente, divida}) => criarCardCliente(nome, cliente, divida, 'em-dia')).join('')}
                        </div>
                    </div>
                `;
            }

            lista.innerHTML = htmlFinal;

            // Atualizar √∫ltima atualiza√ß√£o
            const ultimaAtualizacao = localStorage.getItem('ultimaAtualizacao');
            const dataFormatada = ultimaAtualizacao ? 
                new Date(ultimaAtualizacao).toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Nunca';
            
            document.getElementById('ultima-atualizacao').textContent = dataFormatada;
        }

        // Criar card individual de cliente
        function criarCardCliente(nome, cliente, divida, tipo) {
            let statusConfig = {};
            
            if (tipo === 'deve') {
                statusConfig = {
                    icon: '‚ö†Ô∏è',
                    bgClass: 'bg-white border-l-4 border-red-500',
                    valorClass: 'text-red-600',
                    badgeClass: 'bg-red-100 text-red-800',
                    badgeText: 'DEVE',
                    valor: `R$ ${divida.toFixed(2)}`,
                    hoverClass: 'hover:shadow-red-100'
                };
            } else if (tipo === 'credito') {
                statusConfig = {
                    icon: 'üíé',
                    bgClass: 'bg-white border-l-4 border-blue-500',
                    valorClass: 'text-blue-600',
                    badgeClass: 'bg-blue-100 text-blue-800',
                    badgeText: 'CR√âDITO',
                    valor: `R$ ${Math.abs(divida).toFixed(2)}`,
                    hoverClass: 'hover:shadow-blue-100'
                };
            } else {
                statusConfig = {
                    icon: '‚úÖ',
                    bgClass: 'bg-white border-l-4 border-green-500',
                    valorClass: 'text-green-600',
                    badgeClass: 'bg-green-100 text-green-800',
                    badgeText: 'EM DIA',
                    valor: 'R$ 0,00',
                    hoverClass: 'hover:shadow-green-100'
                };
            }

            // Calcular hist√≥rico recente
            const historicoRecente = historicoVendas
                .filter(h => h.cliente === nome)
                .sort((a, b) => new Date(b.data) - new Date(a.data))
                .slice(0, 3);

            const ultimaCompra = historicoRecente.length > 0 ? 
                new Date(historicoRecente[0].data).toLocaleDateString('pt-BR') : 'Nunca';

            return `
                <div class="group ${statusConfig.bgClass} ${statusConfig.hoverClass} rounded-xl p-5 cursor-pointer transform hover:scale-[1.01] transition-all duration-300 hover:shadow-lg" 
                     onclick="mostrarPerfil('${nome}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="bg-gray-50 rounded-full p-3 text-2xl group-hover:scale-110 transition-transform duration-300">
                                ${statusConfig.icon}
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-gray-800 mb-1">${nome}</h4>
                                <div class="flex items-center space-x-3 text-sm text-gray-600">
                                    <span class="flex items-center">
                                        <span class="mr-1">üì±</span>
                                        ${cliente.celular}
                                    </span>
                                    <span class="${statusConfig.badgeClass} px-2 py-1 rounded-full text-xs font-medium">
                                        ${statusConfig.badgeText}
                                    </span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    √öltima compra: ${ultimaCompra}
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-right">
                            <div class="text-2xl font-bold ${statusConfig.valorClass} mb-1">
                                ${statusConfig.valor}
                            </div>
                            <div class="text-xs text-gray-500 flex items-center justify-end">
                                <span class="mr-1">üëÜ</span>
                                Ver detalhes
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hist√≥rico r√°pido -->
                    ${historicoRecente.length > 0 ? `
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <div class="text-xs text-gray-500 mb-2">√öltimas atividades:</div>
                            <div class="space-y-1">
                                ${historicoRecente.slice(0, 2).map(h => {
                                    const data = new Date(h.data).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                                    const totalVendas = h.vendas.reduce((sum, v) => {
                                        const produto = encontrarProduto(v.produtoOriginal || v.produto);
                                        return sum + (produto ? produto.preco * v.quantidade : 0);
                                    }, 0);
                                    return `
                                        <div class="flex justify-between text-xs">
                                            <span class="text-gray-600">${data} - ${h.vendas.length} item(s)</span>
                                            <span class="text-gray-700 font-medium">R$ ${totalVendas.toFixed(2)}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Atualizar datalists
        function atualizarDataLists() {
            // Lista de clientes
            const clientesList = document.getElementById('clientes-list');
            clientesList.innerHTML = clientes.map(cliente => 
                `<option value="${cliente.nome}">${cliente.nome} (${cliente.celular})</option>`
            ).join('');

            // Lista de produtos
            const produtosList = document.getElementById('produtos-list');
            produtosList.innerHTML = produtos.map(produto => 
                `<option value="${produto.nome}">${produto.nome} - R$ ${produto.preco.toFixed(2)}</option>`
            ).join('');
        }

        // Atualizar resumos
        function atualizarResumos() {
            // Resumo de d√≠vidas
            const dividasPositivas = Object.values(dividas).filter(d => d > 0);
            const dividasNegativas = Object.values(dividas).filter(d => d < 0);
            
            const totalDividas = dividasPositivas.reduce((sum, d) => sum + d, 0);
            const totalCreditos = Math.abs(dividasNegativas.reduce((sum, d) => sum + d, 0));
            
            // Clientes em dia s√£o aqueles sem d√≠vida registrada ou com d√≠vida = 0
            const clientesComDivida = Object.keys(dividas).filter(cliente => Math.abs(dividas[cliente]) > 0.01);
            const clientesEmDia = clientes.length - clientesComDivida.length;

            document.getElementById('total-dividas').textContent = `R$ ${totalDividas.toFixed(2)}`;
            document.getElementById('total-creditos').textContent = `R$ ${totalCreditos.toFixed(2)}`;
            document.getElementById('clientes-em-dia').textContent = clientesEmDia;

            // Resumo do dia - C√ÅLCULOS DETALHADOS
            const totalVendasDia = vendasDia.length;
            let valorTotalVendido = 0;
            let recebidoVista = 0;
            let vendidoFiado = 0;
            let pagamentosVista = 0;
            let pagamentosParciais = 0;
            let vendasFiadas = 0;

            vendasDia.forEach(venda => {
                // Buscar produto pelo nome original se dispon√≠vel
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                valorTotalVendido += totalVenda;
                
                if (venda.status === 'pago') {
                    // PAGO sem valor = recebeu o valor total
                    recebidoVista += totalVenda;
                    pagamentosVista++;
                } else if (venda.status === 'pago-valor') {
                    // PAGO com valor espec√≠fico
                    const valorPagoVenda = venda.valorPago || 0;
                    recebidoVista += valorPagoVenda;
                    
                    // Se pagou menos que o total, o resto fica como fiado
                    const restante = totalVenda - valorPagoVenda;
                    if (restante > 0) {
                        vendidoFiado += restante;
                        pagamentosParciais++;
                    } else {
                        pagamentosVista++;
                    }
                } else {
                    // FIADO = tudo fica como d√≠vida
                    vendidoFiado += totalVenda;
                    vendasFiadas++;
                }
            });

            // Somar pagamentos avulsos ao recebido √† vista
            const totalPagamentosAvulsos = pagamentosAvulsos.reduce((sum, p) => sum + (p.valor || 0), 0);
            recebidoVista += totalPagamentosAvulsos;

            // Atualizar elementos b√°sicos (compatibilidade)
            document.getElementById('total-vendas-dia').textContent = totalVendasDia;
            document.getElementById('valor-total-vendido').textContent = `R$ ${valorTotalVendido.toFixed(2)}`;
            document.getElementById('recebido-vista').textContent = `R$ ${recebidoVista.toFixed(2)}`;
            document.getElementById('vendido-fiado').textContent = `R$ ${vendidoFiado.toFixed(2)}`;

            // ATUALIZAR RELAT√ìRIOS EXECUTIVOS
            atualizarRelatoriosExecutivos(valorTotalVendido, recebidoVista, vendidoFiado, totalVendasDia, pagamentosVista, pagamentosParciais, vendasFiadas, totalPagamentosAvulsos);

            // Produtos mais vendidos (vers√£o b√°sica)
            const produtosMaisVendidos = {};
            vendasDia.forEach(venda => {
                produtosMaisVendidos[venda.produto] = (produtosMaisVendidos[venda.produto] || 0) + venda.quantidade;
            });

            const produtosOrdenados = Object.entries(produtosMaisVendidos)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const listaProdutosMaisVendidos = document.getElementById('produtos-mais-vendidos');
            if (listaProdutosMaisVendidos) {
                if (produtosOrdenados.length === 0) {
                    listaProdutosMaisVendidos.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma venda registrada</p>';
                } else {
                    listaProdutosMaisVendidos.innerHTML = produtosOrdenados.map(([produto, quantidade]) => `
                        <div class="flex justify-between items-center py-2 border-b">
                            <span>${produto}</span>
                            <span class="font-semibold">${quantidade} unidades</span>
                        </div>
                    `).join('');
                }
            }
        }

        // Atualizar relat√≥rios executivos
        function atualizarRelatoriosExecutivos(valorTotalVendido, recebidoVista, vendidoFiado, totalVendasDia, pagamentosVista, pagamentosParciais, vendasFiadas, totalPagamentosAvulsos) {
            // Atualizar timestamp
            const agora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            const elementoTimestamp = document.getElementById('relatorio-ultima-atualizacao');
            if (elementoTimestamp) {
                elementoTimestamp.textContent = agora;
            }

            // M√©tricas principais
            const elementos = {
                'faturamento-hoje': `R$ ${valorTotalVendido.toFixed(2)}`,
                'recebido-vista-relatorio': `R$ ${recebidoVista.toFixed(2)}`,
                'vendido-fiado-relatorio': `R$ ${vendidoFiado.toFixed(2)}`,
                'total-vendas-relatorio': totalVendasDia.toString()
            };

            Object.entries(elementos).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor;
            });

            // An√°lise de pagamentos
            const elementosPagamento = {
                'pagamentos-vista-count': pagamentosVista,
                'pagamentos-parciais-count': pagamentosParciais,
                'vendas-fiadas-count': vendasFiadas,
                'pagamentos-avulsos-count': pagamentosAvulsos.length
            };

            Object.entries(elementosPagamento).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor.toString();
            });

            // M√©tricas de efici√™ncia
            const ticketMedio = totalVendasDia > 0 ? valorTotalVendido / totalVendasDia : 0;
            const taxaPagamento = totalVendasDia > 0 ? (pagamentosVista / totalVendasDia) * 100 : 0;
            const clientesAtendidos = new Set(vendasDia.map(v => v.cliente)).size;

            const elementosEficiencia = {
                'ticket-medio': `R$ ${ticketMedio.toFixed(2)}`,
                'taxa-pagamento': `${taxaPagamento.toFixed(1)}%`,
                'clientes-atendidos': clientesAtendidos.toString()
            };

            Object.entries(elementosEficiencia).forEach(([id, valor]) => {
                const elemento = document.getElementById(id);
                if (elemento) elemento.textContent = valor;
            });

            // Produtos mais vendidos (vers√£o executiva)
            atualizarTopProdutos();
            
            // Clientes mais ativos
            atualizarClientesMaisAtivos();
            
            // Vendas por categoria
            atualizarVendasPorCategoria();
        }

        // Atualizar top produtos
        function atualizarTopProdutos() {
            const produtosMaisVendidos = {};
            const faturamentoPorProduto = {};
            
            vendasDia.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                produtosMaisVendidos[venda.produto] = (produtosMaisVendidos[venda.produto] || 0) + venda.quantidade;
                faturamentoPorProduto[venda.produto] = (faturamentoPorProduto[venda.produto] || 0) + totalVenda;
            });

            const produtosOrdenados = Object.entries(produtosMaisVendidos)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const lista = document.getElementById('produtos-mais-vendidos-relatorio');
            if (!lista) return;

            if (produtosOrdenados.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üì¶</div>
                        <p>Nenhuma venda registrada hoje</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = produtosOrdenados.map(([produto, quantidade], index) => {
                const faturamento = faturamentoPorProduto[produto] || 0;
                const posicao = index + 1;
                const medalha = posicao === 1 ? 'ü•á' : posicao === 2 ? 'ü•à' : posicao === 3 ? 'ü•â' : `${posicao}¬∫`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-100">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${medalha}</span>
                            <div>
                                <div class="font-bold text-gray-800">${produto}</div>
                                <div class="text-sm text-gray-600">${quantidade} unidades vendidas</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-purple-600">R$ ${faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">faturamento</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar clientes mais ativos
        function atualizarClientesMaisAtivos() {
            const clientesAtivos = {};
            const faturamentoPorCliente = {};
            
            vendasDia.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                clientesAtivos[venda.cliente] = (clientesAtivos[venda.cliente] || 0) + 1;
                faturamentoPorCliente[venda.cliente] = (faturamentoPorCliente[venda.cliente] || 0) + totalVenda;
            });

            const clientesOrdenados = Object.entries(clientesAtivos)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const lista = document.getElementById('clientes-mais-ativos');
            if (!lista) return;

            if (clientesOrdenados.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üë§</div>
                        <p>Nenhuma venda registrada hoje</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = clientesOrdenados.map(([cliente, compras], index) => {
                const faturamento = faturamentoPorCliente[cliente] || 0;
                const posicao = index + 1;
                const medalha = posicao === 1 ? 'üëë' : posicao === 2 ? '‚≠ê' : posicao === 3 ? 'üåü' : `${posicao}¬∫`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg border border-green-100 cursor-pointer hover:shadow-md transition-all" onclick="mostrarPerfil('${cliente}')">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${medalha}</span>
                            <div>
                                <div class="font-bold text-gray-800">${cliente}</div>
                                <div class="text-sm text-gray-600">${compras} compras hoje</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">R$ ${faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">total gasto</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Atualizar vendas por categoria
        function atualizarVendasPorCategoria() {
            const vendasPorCategoria = {};
            
            vendasDia.forEach(venda => {
                const nomeBusca = venda.produtoOriginal || venda.produto;
                const produto = encontrarProduto(nomeBusca);
                const categoria = produto ? produto.categoria : 'outros';
                const precoUnitario = produto ? produto.preco : 0;
                const totalVenda = precoUnitario * venda.quantidade;
                
                if (!vendasPorCategoria[categoria]) {
                    vendasPorCategoria[categoria] = { quantidade: 0, faturamento: 0 };
                }
                
                vendasPorCategoria[categoria].quantidade += venda.quantidade;
                vendasPorCategoria[categoria].faturamento += totalVenda;
            });

            const categoriasOrdenadas = Object.entries(vendasPorCategoria)
                .sort(([,a], [,b]) => b.faturamento - a.faturamento);

            const lista = document.getElementById('vendas-por-categoria');
            if (!lista) return;

            if (categoriasOrdenadas.length === 0) {
                lista.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-3xl mb-2">üìà</div>
                        <p class="text-sm">Dados aparecer√£o ap√≥s vendas</p>
                    </div>
                `;
                return;
            }

            const totalFaturamento = categoriasOrdenadas.reduce((sum, [, dados]) => sum + dados.faturamento, 0);

            lista.innerHTML = categoriasOrdenadas.map(([categoria, dados]) => {
                const percentual = totalFaturamento > 0 ? (dados.faturamento / totalFaturamento) * 100 : 0;
                const iconeCategoria = {
                    'doces': 'üç≠',
                    'salgados': 'ü•ü',
                    'chiclete': 'üç¨',
                    'bebidas': 'ü•§',
                    'outros': 'üì¶'
                };
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-100">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${iconeCategoria[categoria] || 'üì¶'}</span>
                            <div>
                                <div class="font-medium text-gray-800 capitalize">${categoria}</div>
                                <div class="text-xs text-gray-600">${dados.quantidade} itens</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-purple-600">R$ ${dados.faturamento.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">${percentual.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Fun√ß√µes de exclus√£o com confirma√ß√£o melhorada
        function excluirProduto(id) {
            const produto = produtos.find(p => p.id === id);
            if (!produto) return;

            // Verificar se produto est√° sendo usado em vendas do dia
            const vendaComProduto = vendasDia.find(v => v.produto === produto.nome);
            let mensagem = `Tem certeza que deseja excluir o produto "${produto.nome}"?`;
            
            if (vendaComProduto) {
                mensagem += '\n\nATEN√á√ÉO: Este produto possui vendas registradas hoje!';
            }

            if (confirm(mensagem)) {
                const loading = mostrarLoading('Excluindo produto...');
                
                setTimeout(() => {
                    produtos = produtos.filter(p => p.id !== id);
                    localStorage.setItem('produtos', JSON.stringify(produtos));
                    
                    removerLoading();
                    atualizarListas();
                    mostrarSucesso(`Produto "${produto.nome}" exclu√≠do!`);
                }, 300);
            }
        }

        function excluirCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;

            const divida = dividas[cliente.nome] || 0;
            let mensagem = `Tem certeza que deseja excluir o cliente "${cliente.nome}"?`;
            
            if (Math.abs(divida) > 0.01) {
                mensagem += `\n\nATEN√á√ÉO: Este cliente possui d√≠vida de R$ ${Math.abs(divida).toFixed(2)}!`;
            }

            const vendaComCliente = vendasDia.find(v => v.cliente === cliente.nome);
            if (vendaComCliente) {
                mensagem += '\n\nEste cliente possui vendas registradas hoje!';
            }

            if (confirm(mensagem)) {
                const loading = mostrarLoading('Excluindo cliente...');
                
                setTimeout(() => {
                    if (dividas[cliente.nome]) {
                        delete dividas[cliente.nome];
                        localStorage.setItem('dividas', JSON.stringify(dividas));
                    }
                    
                    clientes = clientes.filter(c => c.id !== id);
                    localStorage.setItem('clientes', JSON.stringify(clientes));
                    
                    removerLoading();
                    atualizarListas();
                    mostrarSucesso(`Cliente "${cliente.nome}" exclu√≠do!`);
                }, 300);
            }
        }

        function excluirVenda(id) {
            const venda = vendasDia.find(v => v.id == id);
            if (!venda) return;

            if (confirm(`Tem certeza que deseja excluir a venda:\n${venda.quantidade}x ${venda.produto} - ${venda.cliente}?`)) {
                const loading = mostrarLoading('Excluindo venda...');
                
                setTimeout(() => {
                    vendasDia = vendasDia.filter(v => v.id != id);
                    localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
                    
                    removerLoading();
                    atualizarListas();
                    mostrarSucesso('Venda exclu√≠da!');
                }, 300);
            }
        }

        function excluirPagamento(id) {
            const pagamento = pagamentosAvulsos.find(p => p.id === id);
            if (!pagamento) return;

            if (confirm(`Tem certeza que deseja excluir o pagamento:\nR$ ${pagamento.valor.toFixed(2)} - ${pagamento.cliente}?`)) {
                const loading = mostrarLoading('Excluindo pagamento...');
                
                setTimeout(() => {
                    pagamentosAvulsos = pagamentosAvulsos.filter(p => p.id !== id);
                    localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
                    
                    removerLoading();
                    atualizarListas();
                    mostrarSucesso('Pagamento exclu√≠do!');
                }, 300);
            }
        }

        // Sistema de notifica√ß√µes melhorado
        function mostrarNotificacao(mensagem, tipo = 'success', duracao = 3000) {
            // Remover notifica√ß√µes existentes
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notificacao = document.createElement('div');
            notificacao.className = `notification ${tipo}`;
            
            // √çcones para cada tipo
            const icones = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            notificacao.innerHTML = `
                <div class="flex items-center">
                    <span class="text-xl mr-3">${icones[tipo] || icones.info}</span>
                    <span>${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(notificacao);
            
            // Mostrar com anima√ß√£o
            setTimeout(() => notificacao.classList.add('show'), 100);
            
            // Remover ap√≥s o tempo especificado
            setTimeout(() => {
                notificacao.classList.remove('show');
                setTimeout(() => notificacao.remove(), 300);
            }, duracao);
        }

        // Fun√ß√µes de configura√ß√µes
        function abrirConfiguracoes() {
            carregarConfiguracoes();
            document.getElementById('modal-configuracoes').classList.remove('hidden');
            document.getElementById('modal-configuracoes').classList.add('flex');
        }

        function fecharConfiguracoes() {
            salvarConfiguracoes();
            document.getElementById('modal-configuracoes').classList.add('hidden');
            document.getElementById('modal-configuracoes').classList.remove('flex');
        }

        function mostrarConfigTab(tab) {
            // Esconder todas as abas
            document.querySelectorAll('.config-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('[id^="config-tab-"]').forEach(btn => {
                btn.className = btn.className.replace('config-tab-active', 'config-tab-inactive');
            });
            
            // Mostrar aba selecionada
            document.getElementById('config-' + tab).classList.remove('hidden');
            
            // Ativar bot√£o selecionado
            const activeBtn = document.getElementById('config-tab-' + tab);
            activeBtn.className = activeBtn.className.replace('config-tab-inactive', 'config-tab-active');
        }

        function carregarConfiguracoes() {
            // WhatsApp
            document.getElementById('config-mensagem-principal').value = configuracoes.whatsapp.mensagemPrincipal;
            document.getElementById('config-incluir-hora').value = configuracoes.whatsapp.incluirHora.toString();
            document.getElementById('config-formato-data').value = configuracoes.whatsapp.formatoData;
            document.querySelector(`input[name="mostrar-divida-zero"][value="${configuracoes.whatsapp.mostrarDividaZero}"]`).checked = true;
            
            // Visual
            document.getElementById('config-tema').value = configuracoes.visual.tema;
            document.getElementById('config-animacoes').value = configuracoes.visual.animacoes;
            document.getElementById('config-efeito-dopamina').checked = configuracoes.visual.efeitoDopamina;
            document.getElementById('config-sons-feedback').checked = configuracoes.visual.sonsFeedback;
            document.getElementById('config-particulas').checked = configuracoes.visual.particulas;
            document.getElementById('config-modo-netflix').checked = configuracoes.visual.modoNetflix || false;
            
            // Sistema
            document.getElementById('config-auto-save').value = configuracoes.sistema.autoSave.toString();
            document.getElementById('config-confirmacao-exclusao').value = configuracoes.sistema.confirmacaoExclusao;
            document.getElementById('config-limite-busca').value = configuracoes.sistema.limiteBusca.toString();
        }

        function salvarConfiguracoes() {
            const modoNetflixAnterior = configuracoes.visual.modoNetflix;
            
            // WhatsApp
            configuracoes.whatsapp.mensagemPrincipal = document.getElementById('config-mensagem-principal').value;
            configuracoes.whatsapp.incluirHora = document.getElementById('config-incluir-hora').value === 'true';
            configuracoes.whatsapp.formatoData = document.getElementById('config-formato-data').value;
            configuracoes.whatsapp.mostrarDividaZero = document.querySelector('input[name="mostrar-divida-zero"]:checked').value === 'true';
            
            // Visual
            configuracoes.visual.tema = document.getElementById('config-tema').value;
            configuracoes.visual.animacoes = document.getElementById('config-animacoes').value;
            configuracoes.visual.efeitoDopamina = document.getElementById('config-efeito-dopamina').checked;
            configuracoes.visual.sonsFeedback = document.getElementById('config-sons-feedback').checked;
            configuracoes.visual.particulas = document.getElementById('config-particulas').checked;
            configuracoes.visual.modoNetflix = document.getElementById('config-modo-netflix').checked;
            
            // Sistema
            configuracoes.sistema.autoSave = parseInt(document.getElementById('config-auto-save').value);
            configuracoes.sistema.confirmacaoExclusao = document.getElementById('config-confirmacao-exclusao').value;
            configuracoes.sistema.limiteBusca = parseInt(document.getElementById('config-limite-busca').value);
            
            localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
            
            // Aplicar tema se mudou
            if (modoNetflixAnterior !== configuracoes.visual.modoNetflix) {
                aplicarTema();
            }
            
            sons.sucesso();
            mostrarSucesso('‚úÖ Configura√ß√µes salvas e aplicadas!');
        }

        function testarMensagemWhatsApp() {
            const preview = document.getElementById('preview-mensagem');
            const mensagemTemplate = document.getElementById('config-mensagem-principal').value;
            const incluirHora = document.getElementById('config-incluir-hora').value === 'true';
            const formatoData = document.getElementById('config-formato-data').value;
            
            // Dados de exemplo
            const agora = new Date();
            const hora = incluirHora ? agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) : '';
            
            let dataFormatada = '';
            if (formatoData === 'dd/mm') {
                dataFormatada = `${agora.getDate().toString().padStart(2, '0')}/${(agora.getMonth() + 1).toString().padStart(2, '0')}`;
            } else if (formatoData === 'dd/mm/yyyy') {
                dataFormatada = agora.toLocaleDateString('pt-BR');
            } else {
                dataFormatada = agora.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
            }
            
            const mensagemExemplo = mensagemTemplate
                .replace('{hora}', hora)
                .replace('{dividaAnterior}', '15.50')
                .replace('{data}', dataFormatada)
                .replace('{produtos}', '2 brigadeiro (7.00)\n1 coxinha (3.50)')
                .replace('{pagamentos}', 'PAGO 5.00')
                .replace('{dividaTotal}', '21.00');
            
            preview.innerHTML = `<pre class="whitespace-pre-wrap text-sm">${mensagemExemplo}</pre>`;
            preview.classList.remove('hidden');
        }

        function ativarModoNetflix() {
            configuracoes.visual.modoNetflix = true;
            document.getElementById('config-modo-netflix').checked = true;
            salvarConfiguracoes();
            aplicarTema();
            mostrarSucesso('üî• Modo Netflix ativado! Prepare-se para a produtividade m√°xima!');
        }
        
        function desativarModoNetflix() {
            configuracoes.visual.modoNetflix = false;
            document.getElementById('config-modo-netflix').checked = false;
            salvarConfiguracoes();
            aplicarTema();
            mostrarSucesso('üåô Modo normal restaurado!');
        }

        function restaurarPadroes() {
            if (confirm('Tem certeza que deseja restaurar todas as configura√ß√µes para os valores padr√£o?')) {
                configuracoes = {
                    whatsapp: {
                        mensagemPrincipal: '*ATUALIZA√á√ÉO DA CONTA* _{hora}_\ntava {dividaAnterior}\n\n{data}\n{produtos}\n{pagamentos}\n\n*TOTAL={dividaTotal}*',
                        incluirHora: true,
                        formatoData: 'dd/mm',
                        mostrarDividaZero: true
                    },
                    visual: {
                        tema: 'roxo-azul',
                        animacoes: 'alta',
                        efeitoDopamina: true,
                        sonsFeedback: false,
                        particulas: false,
                        modoNetflix: false
                    },
                    sistema: {
                        autoSave: 60,
                        confirmacaoExclusao: 'sempre',
                        limiteBusca: 8
                    }
                };
                
                localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
                carregarConfiguracoes();
                aplicarTema();
                mostrarSucesso('Configura√ß√µes restauradas para os padr√µes!');
            }
        }

        // Fun√ß√µes de backup e limpeza
        function exportarDados() {
            try {
                sons.click();
                const loading = mostrarLoading('Preparando backup...');
                
                setTimeout(() => {
                    const dadosCompletos = {
                        produtos,
                        clientes,
                        dividas,
                        historicoVendas,
                        configuracoes,
                        vendasDia,
                        pagamentosAvulsos,
                        clientesPendentes,
                        dataExportacao: new Date().toISOString(),
                        versao: '2.0'
                    };
                    
                    const blob = new Blob([JSON.stringify(dadosCompletos, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `backup-vendas-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    removerLoading();
                    sons.sucesso();
                    mostrarSucesso('‚úÖ Backup exportado com sucesso!');
                }, 1000);
            } catch (error) {
                sons.erro();
                mostrarErro('‚ùå Erro ao exportar backup: ' + error.message);
            }
        }

        function importarDados(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            sons.click();
            const loading = mostrarLoading('Importando dados...');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dadosImportados = JSON.parse(e.target.result);
                    
                    removerLoading();
                    
                    if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso substituir√° TODOS os dados atuais!\n\nTem certeza que deseja continuar?')) {
                        const loading2 = mostrarLoading('Restaurando dados...');
                        
                        setTimeout(() => {
                            produtos = dadosImportados.produtos || [];
                            clientes = dadosImportados.clientes || [];
                            dividas = dadosImportados.dividas || {};
                            historicoVendas = dadosImportados.historicoVendas || [];
                            configuracoes = dadosImportados.configuracoes || configuracoes;
                            vendasDia = dadosImportados.vendasDia || [];
                            pagamentosAvulsos = dadosImportados.pagamentosAvulsos || [];
                            clientesPendentes = dadosImportados.clientesPendentes || [];
                            
                            // Salvar no localStorage
                            localStorage.setItem('produtos', JSON.stringify(produtos));
                            localStorage.setItem('clientes', JSON.stringify(clientes));
                            localStorage.setItem('dividas', JSON.stringify(dividas));
                            localStorage.setItem('historicoVendas', JSON.stringify(historicoVendas));
                            localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
                            localStorage.setItem('vendasDia', JSON.stringify(vendasDia));
                            localStorage.setItem('pagamentosAvulsos', JSON.stringify(pagamentosAvulsos));
                            localStorage.setItem('clientesPendentes', JSON.stringify(clientesPendentes));
                            
                            removerLoading();
                            aplicarTema();
                            atualizarListas();
                            sons.sucesso();
                            mostrarSucesso('‚úÖ Dados importados com sucesso!');
                        }, 1500);
                    }
                } catch (error) {
                    removerLoading();
                    sons.erro();
                    mostrarErro('‚ùå Erro ao importar dados. Verifique se o arquivo est√° correto.');
                }
            };
            reader.readAsText(file);
            
            // Limpar o input
            event.target.value = '';
        }

        function limparVendasAntigas() {
            sons.click();
            if (confirm('üóÇÔ∏è Tem certeza que deseja limpar o hist√≥rico de vendas com mais de 30 dias?\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
                const loading = mostrarLoading('Limpando hist√≥rico antigo...');
                
                setTimeout(() => {
                    const dataLimite = new Date();
                    dataLimite.setDate(dataLimite.getDate() - 30);
                    
                    const historicoOriginal = historicoVendas.length;
                    historicoVendas = historicoVendas.filter(h => new Date(h.data) > dataLimite);
                    
                    localStorage.setItem('historicoVendas', JSON.stringify(historicoVendas));
                    
                    const removidos = historicoOriginal - historicoVendas.length;
                    removerLoading();
                    
                    if (removidos > 0) {
                        sons.sucesso();
                        mostrarSucesso(`‚úÖ ${removidos} registros antigos removidos!`);
                    } else {
                        mostrarAviso('‚ÑπÔ∏è Nenhum registro antigo encontrado para remover');
                    }
                    
                    atualizarListas();
                }, 1000);
            }
        }

        function limparClientesSemDivida() {
            sons.click();
            if (confirm('üë• Tem certeza que deseja remover clientes sem d√≠vida e sem hist√≥rico de compras?\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
                const loading = mostrarLoading('Analisando clientes...');
                
                setTimeout(() => {
                    const clientesComHistorico = new Set(historicoVendas.map(h => h.cliente));
                    const clientesComDivida = Object.keys(dividas).filter(cliente => Math.abs(dividas[cliente]) > 0.01);
                    
                    const clientesParaManter = clientes.filter(cliente => 
                        clientesComHistorico.has(cliente.nome) || clientesComDivida.includes(cliente.nome)
                    );
                    
                    const removidos = clientes.length - clientesParaManter.length;
                    clientes = clientesParaManter;
                    
                    localStorage.setItem('clientes', JSON.stringify(clientes));
                    
                    removerLoading();
                    
                    if (removidos > 0) {
                        sons.sucesso();
                        mostrarSucesso(`‚úÖ ${removidos} clientes sem atividade removidos!`);
                    } else {
                        mostrarAviso('‚ÑπÔ∏è Nenhum cliente sem atividade encontrado');
                    }
                    
                    atualizarListas();
                }, 1500);
            }
        }

        function limparApenasHistoricoDividas() {
            sons.click();
            if (confirm('üí∞ Tem certeza que deseja ZERAR todas as d√≠vidas?\n\nOs clientes e produtos ser√£o mantidos, apenas as d√≠vidas ser√£o zeradas.\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
                const loading = mostrarLoading('Zerando d√≠vidas...');
                
                setTimeout(() => {
                    const totalClientes = Object.keys(dividas).length;
                    dividas = {};
                    localStorage.setItem('dividas', JSON.stringify(dividas));
                    
                    removerLoading();
                    sons.sucesso();
                    mostrarSucesso(`‚úÖ D√≠vidas de ${totalClientes} clientes foram zeradas!`);
                    atualizarListas();
                }, 1000);
            }
        }

        function resetarSistema() {
            sons.click();
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO M√ÅXIMA: Isso apagar√° TODOS os dados do sistema!\n\n‚Ä¢ Produtos\n‚Ä¢ Clientes\n‚Ä¢ D√≠vidas\n‚Ä¢ Hist√≥rico\n‚Ä¢ Configura√ß√µes\n‚Ä¢ Tudo ser√° perdido!\n\nTem certeza absoluta que deseja continuar?')) {
                if (confirm('üö® √öLTIMA CHANCE!\n\nEsta a√ß√£o √© COMPLETAMENTE IRREVERS√çVEL!\n\nTodos os seus dados ser√£o perdidos para sempre!\n\nConfirma mesmo assim?')) {
                    const loading = mostrarLoading('Resetando sistema...');
                    
                    setTimeout(() => {
                        localStorage.clear();
                        sons.erro();
                        setTimeout(() => {
                            location.reload();
                        }, 1000);
                    }, 2000);
                }
            }
        }

        // Fun√ß√£o de sucesso (mantida para compatibilidade)
        function mostrarSucesso(mensagem) {
            sons.sucesso();
            mostrarNotificacao(mensagem, 'success');
        }

        // Fun√ß√£o de erro
        function mostrarErro(mensagem) {
            sons.erro();
            mostrarNotificacao(mensagem, 'error');
        }

        // Fun√ß√£o de aviso
        function mostrarAviso(mensagem) {
            mostrarNotificacao(mensagem, 'warning');
        }

        // Fun√ß√£o de loading
        function mostrarLoading(mensagem) {
            const loading = document.createElement('div');
            loading.className = 'notification info show';
            loading.id = 'loading-notification';
            loading.innerHTML = `
                <div class="flex items-center">
                    <div class="loading-spinner"></div>
                    <span>${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(loading);
            return loading;
        }

        // Remover loading
        function removerLoading() {
            const loading = document.getElementById('loading-notification');
            if (loading) {
                loading.classList.remove('show');
                setTimeout(() => loading.remove(), 300);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96571e6ef278f617',t:'MTc1MzU2NjY5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
